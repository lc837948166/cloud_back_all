"use strict";(self["webpackChunkkfront"]=self["webpackChunkkfront"]||[]).push([[208],{8208:function(e,t,o){o.r(t),o.d(t,{default:function(){return m}});var l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"vmarea"},[t("el-row",{attrs:{gutter:0}},[t("el-col",{attrs:{span:10,offset:0}},[t("p",{staticStyle:{"font-size":"25px","font-weight":"600","margin-bottom":"20px"}},[e._v(" 部署列表 ")])]),t("el-col",{attrs:{span:2,offset:10}},[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"medium",round:"",plain:""},on:{click:e.openUploadDeployment}},[e._v("上传部署")])],1),t("el-col",{attrs:{span:2}},[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"medium",round:"",plain:""},on:{click:e.openCreateDeployment}},[e._v("添加部署")])],1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.dpdata.slice((e.curpage-1)*e.pagesize,e.curpage*e.pagesize).filter((t=>!e.psearch||t.metadata.name.toLowerCase().includes(e.psearch.toLowerCase()))),"empty-text":"暂无部署","header-cell-style":{background:"#00b8a9",color:"#fff"}}},[t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{width:"250",sortable:"",label:"名称",prop:"metadata.name"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"命名空间",prop:"metadata.namespace"}}),t("el-table-column",{attrs:{width:"500",sortable:"",label:"标签",prop:"metadata.labels"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(JSON.stringify(t.row.metadata.labels).replaceAll("{","").replaceAll("}","").replaceAll('"',""))+" ")]}}])}),t("el-table-column",{attrs:{width:"80",sortable:"",label:"Pod",prop:"pod"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.status.readyReplicas?t.row.status.readyReplicas:0)+"/"+e._s(t.row.status.replicas)+" ")]}}])}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"创建时间",prop:"metadata.creationTimestamp"}}),t("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("div",{staticStyle:{"text-align":"center"}},[t("el-button-group",[t("el-button",{attrs:{plain:"",type:"success"},on:{click:function(t){return e.startDeployment(o.row.metadata.name)}}},[e._v("启动")]),t("el-button",{attrs:{plain:"",type:"warning"},on:{click:function(t){return e.stopDeployment(o.row.metadata.name)}}},[e._v("暂停")]),t("el-button",{attrs:{plain:"",type:"danger"},on:{click:function(t){return e.delDeployment(o.row.metadata.name)}}},[e._v("删除")])],1)],1)]}}])},[t("template",{slot:"header"},[t("el-input",{attrs:{size:"mini",placeholder:"输入名称搜索"},model:{value:e.psearch,callback:function(t){e.psearch=t},expression:"psearch"}})],1)],2)],1),0!=e.dpdata.length?t("div",{staticStyle:{"margin-top":"30px"}},[t("el-pagination",{attrs:{"current-page":e.curpage,"page-sizes":[10,20,30,40,50],"page-size":e.pagesize,layout:"sizes, total, prev, pager, next, jumper",total:e.totaldp,background:""},on:{"update:currentPage":function(t){e.curpage=t},"update:current-page":function(t){e.curpage=t},"update:pageSize":function(t){e.pagesize=t},"update:page-size":function(t){e.pagesize=t}}})],1):e._e(),t("el-dialog",{attrs:{title:"上传部署",visible:e.uploaddeploymentvisible},on:{"update:visible":function(t){e.uploaddeploymentvisible=t}}},[t("div",{staticStyle:{"text-align":"center"}},[t("el-upload",{ref:"upload",staticClass:"upload-demo",staticStyle:{width:"100%"},attrs:{drag:"",action:"https://run.mocky.io/v3/9d059bf9-4660-45f2-925d-ce80ad6c4d15","auto-upload":!1,accept:".yaml",limit:1,"on-change":e.handleChange,"http-request":e.uploadFile,"file-list":e.fileList,"on-exceed":e.handleExceed,"before-upload":e.handleBeforeUpload,"on-success":e.sucupload,"on-error":e.errupload}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),t("em",[e._v("点击上传")])]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("*只能上传.yaml文件")])]),t("div",{staticStyle:{"padding-top":"50px"}},[t("el-button",{staticClass:"ml-3",attrs:{round:"",plain:"",type:"primary"},on:{click:e.submitUpload}},[e._v(" 上传到服务器 ")])],1)],1)]),t("el-dialog",{attrs:{title:"添加应用",visible:e.createDeploymentvisible},on:{"update:visible":function(t){e.createDeploymentvisible=t}}},[t("el-form",{ref:"deployment_form",attrs:{"label-position":"top","label-width":"80px",model:e.deployment_form,"status-icon":!0,rules:e.deployment_rules}},[t("el-form-item",{attrs:{label:"应用名称",prop:"deploymentName"}},[t("el-input",{attrs:{placeholder:"请输入应用名称"},model:{value:e.deployment_form.deploymentName,callback:function(t){e.$set(e.deployment_form,"deploymentName",t)},expression:"deployment_form.deploymentName"}})],1),t("el-form-item",{attrs:{label:"镜像名称",prop:"image"}},[t("el-input",{attrs:{placeholder:"请输入镜像名称"},model:{value:e.deployment_form.image,callback:function(t){e.$set(e.deployment_form,"image",t)},expression:"deployment_form.image"}})],1),t("el-form-item",{attrs:{label:"容器端口号",prop:"containerPort"}},[t("el-input",{attrs:{placeholder:"请输入容器端口号"},model:{value:e.deployment_form.containerPort,callback:function(t){e.$set(e.deployment_form,"containerPort",t)},expression:"deployment_form.containerPort"}})],1),t("el-form-item",{attrs:{label:"服务端口号",prop:"servicePort"}},[t("el-input",{attrs:{placeholder:"请输入服务端口号"},model:{value:e.deployment_form.servicePort,callback:function(t){e.$set(e.deployment_form,"servicePort",t)},expression:"deployment_form.servicePort"}})],1),t("el-form-item",{attrs:{label:"节点端口号",prop:"nodePort"}},[t("el-input",{attrs:{placeholder:"请输入节点端口号"},model:{value:e.deployment_form.nodePort,callback:function(t){e.$set(e.deployment_form,"nodePort",t)},expression:"deployment_form.nodePort"}})],1),t("el-form-item",{attrs:{size:"large"}},[t("div",{staticClass:"cp-sbm-area"},[t("el-button",{attrs:{round:""},on:{click:function(t){return e.resetForm("deployment_form")}}},[e._v("清空输入")]),t("el-button",{attrs:{round:"",type:"primary"},on:{click:function(t){return e.deployment_sumbit("deployment_form")}}},[e._v("立即创建")])],1)])],1)],1)],1)},a=[],s=o(6369),i={name:"DeployView",mounted(){this.getDeploymentList()},data(){return{baseurl:"http://127.0.0.1:8080",dpdata:[],psearch:"",curpage:1,totaldp:0,pagesize:10,fileList:[],fileType:["yaml"],createDeploymentvisible:!1,uploaddeploymentvisible:!1,deployment_form:{deploymentName:"",image:"",containerPort:"",servicePort:"",nodePort:""},deployment_rules:{deploymentName:[{required:!0,message:"请输入应用名称",trigger:"blur"}],image:[{required:!0,message:"请输入镜像名称",trigger:"blur"}],containerPort:[{required:!0,message:"请输入容器端口",trigger:"blur"}],servicePort:[{required:!0,message:"请输入服务端口",trigger:"blur"}],nodePort:[{required:!0,message:"请输入节点端口",trigger:"blur"}]}}},methods:{del:s.del,openUploadDeployment(){this.uploaddeploymentvisible=!0},openCreateDeployment(){this.createDeploymentvisible=!0},resetForm(e){this.$refs[e].resetFields()},deployment_sumbit(e){this.$refs[e].validate((e=>{if(!e)return console.log("表单验证不通过"),!1;this.$axios({method:"post",url:this.baseurl+"/deployment/deployByParam",data:{deploymentName:this.deployment_form.deploymentName,image:this.deployment_form.image,containerPort:this.deployment_form.containerPort,servicePort:this.deployment_form.servicePort,nodePort:this.deployment_form.nodePort},headers:{"Content-Type":"application/json"}}).then((e=>{console.log(e),"E"===e.data[0]?this.$notify.error({title:"创建失败",message:e.data,position:"bottom-right"}):(this.$notify.success({title:"完成通知",message:"应用 "+this.deployment_form.deploymentName+" 创建成功",position:"bottom-right"}),this.createDeploymentvisible=!1,setTimeout((()=>{this.getDeploymentList()}),1e3))}),(e=>{console.log(e),this.$notify.error({title:"创建失败",message:"请检查网络连接设置",position:"bottom-right"})})),this.createpodvisible=!1}))},getDeploymentList(){this.$axios.get(this.baseurl+"/deployment/list").then((e=>{this.dpdata=JSON.parse(e.data.result).items,this.totaldp=JSON.parse(e.data.result).items.length})).catch((e=>{console.log("errors",e)}))},delDeployment(e){console.log(e),this.$axios({method:"post",url:this.baseurl+"/deployment/deleteDeployment?deploymentName="+e,data:{deploymentName:e},headers:{"Content-Type":"application/json"}}).then((t=>{this.$notify.success({title:"操作通知",message:"应用 "+e+"删除成功",position:"bottom-right"}),this.getDeploymentList()}),(e=>{console.log(e),this.$notify.error({title:"删除失败",message:"请检查网络连接设置",position:"bottom-right"})}))},stopDeployment(e){console.log(e),this.$axios({method:"get",url:this.baseurl+"/deployment/stopDeployment?deploymentName="+e,data:{deploymentName:e},headers:{"Content-Type":"application/json"}}).then((t=>{this.$notify.success({title:"操作通知",message:"应用 "+e+"暂停成功",position:"bottom-right"}),setTimeout((()=>{this.getDeploymentList()}),1e3)}),(e=>{console.log(e),this.$notify.error({title:"暂停失败",message:"请检查网络连接设置",position:"bottom-right"})}))},startDeployment(e){console.log(e),this.$axios({method:"get",url:this.baseurl+"/deployment/startDeployment?deploymentName="+e,data:{deploymentName:e},headers:{"Content-Type":"application/json"}}).then((t=>{this.$notify.success({title:"操作通知",message:"应用 "+e+"启动成功",position:"bottom-right"}),setTimeout((()=>{this.getDeploymentList()}),1e3)}),(e=>{console.log(e),this.$notify.error({title:"暂停失败",message:"请检查网络连接设置",position:"bottom-right"})}))},handleChange(e,t){this.fileList=t},uploadFile(e){this.formData.append("file",e.file)},handleExceed(){this.$message({type:"warning",message:"超出最大上传文件数量的限制！"})},submitUpload(){let e=new FormData;e.append("yamlFile",this.fileList[0].raw),console.log(e),console.log(this.fileList[0]),this.$axios({method:"post",url:this.baseurl+"/deployment/createDeployment",data:e,headers:{"Content-Type":"multipart/form-data"}}).then((e=>{this.$notify.success({title:"操作通知",message:"应用 "+name+"创建成功",position:"bottom-right"}),setTimeout((()=>{this.getDeploymentList()}),2e3)}),(e=>{console.log(e),this.$notify.error({title:"创建失败",message:"请检查网络连接设置",position:"bottom-right"})}))}}},r=i,n=o(1001),p=(0,n.Z)(r,l,a,!1,null,null,null),m=p.exports}}]);
//# sourceMappingURL=208.bdf43c79.js.map