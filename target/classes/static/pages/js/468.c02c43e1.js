"use strict";(self["webpackChunkkfront"]=self["webpackChunkkfront"]||[]).push([[468],{2468:function(e,t,s){s.r(t),s.d(t,{default:function(){return u}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"vmarea"},[t("el-row",{attrs:{gutter:0}},[t("el-col",{attrs:{span:10,offset:0}},[t("p",{staticStyle:{"font-size":"25px","font-weight":"600","margin-bottom":"20px"}},[e._v(" 虚拟机列表 ")])]),t("el-col",{attrs:{span:2,offset:12}},[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"medium",round:"",plain:""},on:{click:e.openCreateVM}},[e._v("新增虚拟机 ")])],1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.vmdata.slice((e.curpage-1)*e.pagesize,e.curpage*e.pagesize).filter((t=>!e.psearch||t.name.toLowerCase().includes(e.psearch.toLowerCase()))),"empty-text":"暂无虚拟机","header-cell-style":{background:"#00b8a9",color:"#fff"}}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"100"}}),t("el-table-column",{attrs:{width:"400",sortable:"",label:"名称",prop:"name"}}),t("el-table-column",{attrs:{width:"300",sortable:"",label:"状态",prop:"state"},scopedSlots:e._u([{key:"default",fn:function(s){return["VIR_DOMAIN_PAUSED"===s.row.state?t("el-tag",{attrs:{type:"warning"}},[e._v("挂起")]):"VIR_DOMAIN_RUNNING"===s.row.state?t("el-tag",[e._v("运行")]):t("el-tag",{attrs:{type:"danger"}},[e._v("关机")])]}}])}),t("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button-group",[t("el-button",{attrs:{plain:"",type:"success"},on:{click:function(t){return e.vmstart(s.row)}}},[e._v("启动")]),t("el-button",{attrs:{plain:"",type:"warning"},on:{click:function(t){return e.vmsuspend(s.row)}}},[e._v("挂起")]),t("el-button",{attrs:{plain:"",type:"success"},on:{click:function(t){return e.vmresume(s.row)}}},[e._v("还原")]),t("el-button",{attrs:{plain:"",type:"primary"},on:{click:function(t){return e.vmreboot(s.row)}}},[e._v("重启")]),t("el-button",{attrs:{plain:"",type:"info"},on:{click:function(t){return e.vmshutdown(s.row)}}},[e._v("关闭")]),t("el-button",{attrs:{plain:"",type:"danger"},on:{click:function(t){return e.vmshutdownMust(s.row)}}},[e._v("强制关闭")]),t("el-button",{attrs:{plain:"",type:"danger"},on:{click:function(t){return e.vmdelete(s.row)}}},[e._v("删除")])],1)]}}])},[t("template",{slot:"header"},[t("el-input",{staticStyle:{width:"30%"},attrs:{size:"mini",placeholder:"输入名称搜索"},model:{value:e.psearch,callback:function(t){e.psearch=t},expression:"psearch"}})],1)],2)],1),0!=e.vmdata.length?t("div",{staticStyle:{"margin-top":"30px"}},[t("el-pagination",{attrs:{"current-page":e.curpage,"page-sizes":[10,20,30,40,50],"page-size":e.pagesize,layout:"sizes, total, prev, pager, next, jumper",total:e.totalvm,background:""},on:{"update:currentPage":function(t){e.curpage=t},"update:current-page":function(t){e.curpage=t},"update:pageSize":function(t){e.pagesize=t},"update:page-size":function(t){e.pagesize=t}}})],1):e._e(),t("el-dialog",{attrs:{title:"创建虚拟机",visible:e.buildvmvisible},on:{"update:visible":function(t){e.buildvmvisible=t}}},[t("el-form",{ref:"formData",attrs:{"label-position":"top","label-width":"80px",model:e.formData,"status-icon":!0,rules:e.vm_rules}},[t("el-row",{attrs:{gutter:30}},[t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"虚拟机名称",prop:"name"}},[t("el-input",{staticStyle:{width:"60%"},attrs:{placeholder:"请输入虚拟机名称"},on:{blur:function(t){return e.validName()}},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1)],1),t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"内存",prop:"memory"}},[t("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",placeholder:"请选择内存大小(GiB)"},model:{value:e.formData.memory,callback:function(t){e.$set(e.formData,"memory",t)},expression:"formData.memory"}},e._l(e.memory_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:30}},[t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"CPU个数",prop:"cpuNum"}},[t("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",placeholder:"请选择CPU个数"},model:{value:e.formData.cpuNum,callback:function(t){e.$set(e.formData,"cpuNum",t)},expression:"formData.cpuNum"}},e._l(e.cpunum_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"系统类型",prop:"OStype"}},[t("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",placeholder:"请选择系统类型"},model:{value:e.formData.OStype,callback:function(t){e.$set(e.formData,"OStype",t)},expression:"formData.OStype"}},e._l(e.ostype_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-form-item",{attrs:{label:"虚拟机映像文件",prop:"vm_iso"}},[t("el-upload",{ref:"upload",staticClass:"upload-demo",staticStyle:{width:"30%"},attrs:{drag:"",action:e.baseurl+"/addVirtual",multiple:!1,data:e.formData,accept:".iso","auto-upload":!1,limit:1,"before-upload":e.handleBeforeUpload,"on-success":e.sucupload,"on-error":e.errupload}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v(" 将文件拖到此处，或"),t("em",[e._v("点击上传")])]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("*只能上传.iso/ .qemu2/ .img文件")])])],1),t("el-form-item",{attrs:{size:"large"}},[t("div",{staticClass:"vmc-sbm-area"},[t("el-button",{attrs:{round:""},on:{click:function(t){return e.resetForm("formData")}}},[e._v("清空输入")]),t("el-button",{attrs:{round:"",type:"primary"},on:{click:function(t){return e.vmc_sumbit("formData")}}},[e._v("立即创建")])],1)])],1)],1)],1)},l=[],i={name:"VMList",mounted(){this.getVMList()},data(){return{baseurl:"http://192.168.91.129:8080",vmdata:[],psearch:"",curpage:1,totalvm:0,pagesize:10,buildvmvisible:!1,ostype_options:[{label:"x86",value:"X86"},{label:"arm",value:"arm"}],cpunum_options:[{label:"1 个",value:"1"},{label:"2 个",value:"2"},{label:"4 个",value:"4"},{label:"6 个",value:"6"},{label:"8 个",value:"8"},{label:"10 个",value:"10"}],memory_options:[{label:"1 GiB",value:"1"},{label:"2 GiB",value:"2"},{label:"4 GiB",value:"4"},{label:"6 GiB",value:"6"},{label:"8 GiB",value:"8"},{label:"16 GiB",value:"16"},{label:"24 GiB",value:"24"},{label:"32 GiB",value:"32"}],formData:{name:"",memory:"",cpuNum:"",OStype:""},vm_rules:{name:[{required:!0,message:"请输入虚拟机名称",trigger:"blur"}],memory:[{required:!0,message:"请选择内存大小",trigger:"change"}],cpuNum:[{required:!0,message:"请选择CPU个数",trigger:"change"}],OStype:[{required:!0,message:"请选择系统类型",trigger:"change"}]}}},methods:{getVMList(){this.$axios.get(this.baseurl+"/getVMList").then((e=>{this.vmdata=e.data,this.totalvm=e.data.length})).catch((e=>{console.log("errors",e)}))},openCreateVM(){this.buildvmvisible=!0},validName(){this.formData.name.includes(".")&&this.$notify.error({message:"虚拟机名字不能包括特殊字符"})},errupload(e,t,s){this.$notify.error({title:"创建失败",message:JSON.parse(e.message).message,position:"bottom-right",duration:6e3})},sucupload(e,t,s){"ok"===e?(this.$notify.success({title:"创建成功",message:"虚拟机 "+this.formData.name+" 创建成功！",position:"bottom-right",duration:6e3}),this.buildvmvisible=!1):this.$notify.error({title:"创建失败",message:e,position:"bottom-right",duration:6e3})},handleBeforeUpload(e){console.log(e);var t=e.name.substring(e.name.lastIndexOf(".")+1);return"iso"!=t&&"img"!=t&&"qcow2"!=t?(this.$message.error("只能上传iso、img或qcow2格式的文件！"),!1):t},vmc_sumbit(e){this.$refs[e].validate((e=>{if(!e)return console.log("表单验证不通过"),!1;this.$refs.upload.submit()}))},resetForm(e){this.$refs[e].resetFields()},vmstart(e){this.$axios.get(this.baseurl+"/initiate/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("启动成功！"),this.getVMList()):this.$message.success("启动失败！")}))},vmsuspend(e){this.$axios.get(this.baseurl+"/suspended/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("挂起成功！"),this.getVMList()):this.$message.success("挂起失败！")}))},vmresume(e){this.$axios.get(this.baseurl+"/resume/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("还原成功！"),this.getVMList()):this.$message.success("还原失败！")}))},vmreboot(e){this.$axios.get(this.baseurl+"/reboot/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("重启中..."),this.getVMList()):this.$message.success("重启失败！")}))},vmshutdown(e){this.$axios.get(this.baseurl+"/shutdown/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("关机成功！"),this.getVMList()):this.$message.success("关机失败！")}))},vmshutdownMust(e){this.$confirm("您确定强行关机吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$axios.get(this.baseurl+"/shutdownMust/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("强行关机成功！"),this.getVMList()):this.$message.success("强行关机失败！")}))})).catch((()=>{this.$message({type:"info",message:"已取消"})}))},vmdelete(e){this.$confirm("您确定删除该虚拟机吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$axios.delete(this.baseurl+"/delete/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("删除成功！"),this.getVMList()):this.$message.success("删除失败！")}))})).catch((()=>{this.$message({type:"info",message:"已取消"})}))}}},o=i,r=s(1001),n=(0,r.Z)(o,a,l,!1,null,null,null),u=n.exports}}]);
//# sourceMappingURL=468.c02c43e1.js.map