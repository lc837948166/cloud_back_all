"use strict";(self["webpackChunkkfront"]=self["webpackChunkkfront"]||[]).push([[878],{14878:function(e,t,a){a.r(t),a.d(t,{default:function(){return p}});var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"podarea"},[t("el-row",{attrs:{gutter:0}},[t("el-col",{attrs:{span:10,offset:0}},[t("p",{staticStyle:{"font-size":"25px","font-weight":"600","margin-bottom":"20px"}},[e._v(" Pod列表 ")])]),t("el-col",{attrs:{span:2,offset:12}},[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"medium",round:"",plain:""},on:{click:e.openCreatePod}},[e._v("添加容器")])],1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.poddata.slice((e.curpage-1)*e.pagesize,e.curpage*e.pagesize).filter((t=>!e.psearch||t.metadata.name.toLowerCase().includes(e.psearch.toLowerCase()))),"empty-text":"暂无Pod","header-cell-style":{background:"#00b8a9",color:"#fff"}}},[t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[t("el-form-item",{attrs:{label:"Pod名称"}},[t("span",[e._v(e._s(a.row.metadata.name))])]),t("el-form-item",{attrs:{label:"命名空间"}},[t("span",[e._v(e._s(a.row.metadata.namespace))])]),t("el-form-item",{attrs:{label:"节点"}},[t("span",[e._v(e._s(a.row.spec.nodeName))])]),t("el-form-item",{attrs:{label:"状态"}},[t("span",["Pending"===a.row.status.phase?t("el-tag",{attrs:{type:"warning"}},[e._v("挂起")]):"Running"===a.row.status.phase?t("el-tag",[e._v("运行")]):t("el-tag",{attrs:{type:"success"}},[e._v("成功")])],1)]),t("el-form-item",{attrs:{label:"是否可用"}},[t("span",["Yes"===a.row.metadata.annotations.status?t("el-tag",{attrs:{type:"success"}},[e._v("可用")]):t("el-tag",{attrs:{type:"danger"}},[e._v("不可用")])],1)]),t("el-form-item",{attrs:{label:"创建时间"}},[t("div",[t("span",[e._v(e._s(e.formatDate(a.row.metadata.creationTimestamp,"YYYY-MM-DD")))]),t("br"),t("span",[e._v(e._s(e.formatDate(a.row.metadata.creationTimestamp,"HH:mm:ss")))])])]),t("el-form-item",{attrs:{label:"容器列表"}}),t("el-form-item",{attrs:{label:"路径"}},[t("div",[e._v(" "+e._s(a.row.info.ppname)+":"+e._s(a.row.info.podpath)+" ")])]),t("el-table",{staticStyle:{width:"90%"},attrs:{size:"small",data:a.row.spec.containers}},[t("el-table-column",{attrs:{type:"index"}}),t("el-table-column",{attrs:{prop:"name",label:"容器名称",width:"200"}}),t("el-table-column",{attrs:{prop:"image",label:"容器镜像",width:"400"}}),t("el-table-column",{attrs:{prop:"ports",label:"端口号"},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(a.row.ports,(function(a){return t("el-tag",{key:a,attrs:{type:"info"}},[e._v(e._s(a.name+"/"+a.protocol+"/"+a.containerPort))])}))}}],null,!0)})],1)],1)]}}])}),t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{width:"280",sortable:"",label:"Pod名称",prop:"metadata.name"}}),t("el-table-column",{attrs:{width:"300",sortable:"",label:"镜像",prop:"spec.containers[0].image"}}),t("el-table-column",{attrs:{width:"150",sortable:"",label:"命名空间",prop:"metadata.namespace"}}),t("el-table-column",{attrs:{sortable:"",label:"节点",prop:"spec.nodeName"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.$store.state.nodetype+"节点"+e.$store.state.nodename[e.$store.state.nodename.length-1])+" ")]}}])}),t("el-table-column",{attrs:{width:"100",sortable:"",label:"状态",prop:"status.phase"},scopedSlots:e._u([{key:"default",fn:function(a){return["Pending"===a.row.status.phase?t("el-tag",{attrs:{type:"warning"}},[e._v("挂起")]):"Running"===a.row.status.phase?t("el-tag",[e._v("运行")]):t("el-tag",{attrs:{type:"success"}},[e._v("成功")])]}}])}),t("el-table-column",{attrs:{width:"100",sortable:"",label:"是否可用",prop:"metadata.annotations.status"},scopedSlots:e._u([{key:"default",fn:function(a){return["Yes"===a.row.metadata.annotations.status?t("el-tag",{attrs:{type:"success"}},[e._v("可用")]):t("el-tag",{attrs:{type:"danger"}},[e._v("不可用")])]}}])}),t("el-table-column",{attrs:{sortable:"",label:"创建时间",prop:"metadata.creationTimestamp"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",[t("span",[e._v(e._s(e.formatDate(a.row.metadata.creationTimestamp,"YYYY-MM-DD")))]),t("br"),t("span",[e._v(e._s(e.formatDate(a.row.metadata.creationTimestamp,"HH:mm:ss")))])])]}}])}),t("el-table-column",{attrs:{width:"210",align:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-popover",{ref:"popover"+a.$index,attrs:{placement:"left",width:"300",trigger:"click"}},[t("el-form",{ref:"migrate_form"+a.$index,attrs:{"label-position":"top","label-width":"80px",model:e.migrate_form,"status-icon":!0,rules:e.migrate_rules}},[t("el-form-item",{attrs:{label:"请选择要迁移的节点",prop:"nodename"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择要迁移的节点"},on:{"visible-change":e.noderemote},model:{value:e.migrate_form.nodename,callback:function(t){e.$set(e.migrate_form,"nodename",t)},expression:"migrate_form.nodename"}},e._l(e.nodename_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{size:"large"}},[t("div",{staticStyle:{"text-align":"right"}},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.migrate_sumbit(a.$index,a.row,"migrate_form"+a.$index)}}},[e._v("确定迁移")])],1)])],1)],1),t("el-button-group",[t("el-button",{directives:[{name:"popover",rawName:"v-popover",value:"popover"+a.$index,expression:"'popover' + scope.$index"}],attrs:{plain:"",type:"info",size:"mini"}},[e._v("迁移")]),"No"===a.row.metadata.annotations.status?t("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.startPod(a.$index,a.row)}}},[e._v("启动")]):t("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.stopPod(a.$index,a.row)}}},[e._v("停止")]),t("el-button",{attrs:{plain:"",size:"mini",type:"danger"},on:{click:function(t){return e.deletePod(a.$index,a.row)}}},[e._v("删除")])],1)]}}])},[t("template",{slot:"header"},[t("el-input",{attrs:{size:"mini",placeholder:"输入名称搜索"},model:{value:e.psearch,callback:function(t){e.psearch=t},expression:"psearch"}})],1)],2)],1),0!=e.poddata.length?t("div",{staticStyle:{"margin-top":"30px"}},[t("el-pagination",{attrs:{"current-page":e.curpage,"page-sizes":[10,20,30,40,50],"page-size":e.pagesize,layout:"sizes, total, prev, pager, next, jumper",total:e.totalpod,background:""},on:{"update:currentPage":function(t){e.curpage=t},"update:current-page":function(t){e.curpage=t},"update:pageSize":function(t){e.pagesize=t},"update:page-size":function(t){e.pagesize=t}}})],1):e._e(),t("el-dialog",{attrs:{title:"添加Pod",visible:e.createpodvisible},on:{"update:visible":function(t){e.createpodvisible=t}}},[t("el-form",{ref:"cp_form",attrs:{"label-position":"top","label-width":"80px",model:e.cp_form,"status-icon":!0,rules:e.cp_rules}},[t("el-form-item",{attrs:{label:"Pod名称",prop:"podName"}},[t("el-input",{attrs:{placeholder:"请输入Pod名称"},model:{value:e.cp_form.podName,callback:function(t){e.$set(e.cp_form,"podName",t)},expression:"cp_form.podName"}})],1),t("el-form-item",{attrs:{label:"命名空间",prop:"namespace"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择命名空间"},on:{"visible-change":e.nsremote},model:{value:e.cp_form.namespace,callback:function(t){e.$set(e.cp_form,"namespace",t)},expression:"cp_form.namespace"}},e._l(e.namespace_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"选择节点",prop:"nodename"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择节点"},on:{"visible-change":e.noderemote},model:{value:e.cp_form.nodename,callback:function(t){e.$set(e.cp_form,"nodename",t)},expression:"cp_form.nodename"}},e._l(e.nodename_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"选择持久卷声明",prop:"pvcName"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择pvc"},on:{"visible-change":e.pvcremote},model:{value:e.cp_form.pvcName,callback:function(t){e.$set(e.cp_form,"pvcName",t)},expression:"cp_form.pvcName"}},e._l(e.pvcName_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"所属容器",prop:"containerInfoList"}},[e._l(e.cp_form.containerInfoList,(function(a){return t("el-popover",{key:a.containerName,staticStyle:{"margin-right":"10px"},attrs:{placement:"top-start",title:a.containerName,width:"200",trigger:"hover"}},[t("el-descriptions",{attrs:{column:1,size:"mini"}},[t("el-descriptions-item",{attrs:{label:"镜像"}},[e._v(e._s(a.containerImage))]),t("el-descriptions-item",{attrs:{label:"端口号"}},[e._v(e._s(a.port))])],1),t("el-tag",{attrs:{slot:"reference",closable:"","disable-transitions":!1,type:"info",effect:"plain"},on:{close:function(t){return e.handleClose(a)}},slot:"reference"},[e._v(" "+e._s(a.containerName)+" ")])],1)})),e.addvisible?t("el-card",{staticClass:"con-card",attrs:{shadow:"hover"}},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12,offset:0}},[t("span",[e._v("添加第 "+e._s(e.cp_form.containerInfoList.length+1)+" 个新容器")])]),t("el-col",{attrs:{span:3,offset:3}},[t("el-button",{attrs:{icon:"el-icon-check",size:"mini",circle:"",plain:"",type:"success"},on:{click:function(t){return e.addcontainer("tmp_con_info")}}})],1),t("el-col",{attrs:{span:3,offset:0}},[t("el-button",{attrs:{icon:"el-icon-refresh-right",size:"mini",circle:""},on:{click:function(t){return e.resetForm("tmp_con_info")}}})],1),t("el-col",{attrs:{span:3,offset:0}},[t("el-button",{attrs:{icon:"el-icon-close",size:"mini",circle:"",plain:"",type:"danger"},on:{click:e.closeadd}})],1)],1)],1),t("el-form",{ref:"tmp_con_info",attrs:{"label-position":"top",model:e.tmp_con_info,"status-icon":!0,rules:e.tmp_con_rules}},[t("el-form-item",{attrs:{label:"容器名称",prop:"containerName"}},[t("el-input",{attrs:{placeholder:"请输入容器名称",clearable:""},model:{value:e.tmp_con_info.containerName,callback:function(t){e.$set(e.tmp_con_info,"containerName",t)},expression:"tmp_con_info.containerName"}})],1),t("el-form-item",{attrs:{label:"容器镜像",prop:"containerImage"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择容器镜像"},on:{"visible-change":e.imageremote},model:{value:e.tmp_con_info.containerImage,callback:function(t){e.$set(e.tmp_con_info,"containerImage",t)},expression:"tmp_con_info.containerImage"}},e._l(e.containerImage_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"端口号",prop:"port"}},[t("el-input",{attrs:{placeholder:"请输入端口号"},model:{value:e.tmp_con_info.port,callback:function(t){e.$set(e.tmp_con_info,"port",t)},expression:"tmp_con_info.port"}})],1)],1)],1):t("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showInputCon}},[e._v("添加容器")])],2),t("el-form-item",{attrs:{size:"large"}},[t("div",{staticClass:"cp-sbm-area"},[t("el-button",{attrs:{round:""},on:{click:function(t){return e.resetForm("cp_form")}}},[e._v("清空输入")]),t("el-button",{attrs:{round:"",type:"primary"},on:{click:function(t){return e.cp_sumbit("cp_form")}}},[e._v("立即创建")])],1)])],1)],1)],1)},s=[],n=(a(70560),{name:"PodList",data(){var e=(e,t,a)=>{if(console.log(t),t.length<1)return a(new Error("请添加至少一个容器"));a()};return{addvisible:!1,tmp_con_info:{containerName:"",containerImage:"",port:"80"},tmp_con_rules:{containerName:[{required:!0,message:"请输入容器名称",trigger:"blur"}],containerImage:[{required:!0,message:"请选择容器镜像",trigger:"change"}],port:[{required:!0,message:"请输入端口号",trigger:"blur"}]},namespace_options:[],containerImage_options:[{value:"",label:""}],nodename_options:[],pvcName_options:[],baseurl:"http://39.98.124.97:8080",poddata:[],psearch:"",isstart:!1,curpage:1,totalpod:0,pagesize:10,createpodvisible:!1,cp_form:{podName:"",namespace:"",nodename:"",pvcName:"",containerInfoList:[]},migrate_form:{nodename:""},cp_rules:{podName:[{required:!0,message:"请输入Pod名称",trigger:"blur"}],namespace:[{required:!0,message:"请选择命名空间",trigger:"change"}],nodename:[{required:!0,message:"请选择节点",trigger:"change"}],pvcName:[{required:!0,message:"请输入Pvc名称",trigger:"change"}],containerInfoList:[{validator:e,trigger:"change"}]},migrate_rules:{nodename:[{required:!0,message:"请选择迁移的节点名称",trigger:"change"}]}}},mounted(){this.getPodList()},methods:{formatDate(e,t){const a=new Date(e),o=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),n=String(a.getDate()).padStart(2,"0"),r=String(a.getHours()).padStart(2,"0"),i=String(a.getMinutes()).padStart(2,"0"),l=String(a.getSeconds()).padStart(2,"0");return"YYYY-MM-DD"===t?`${o}-${s}-${n}`:"HH:mm:ss"===t?`${r}:${i}:${l}`:""},showInputCon(){this.addvisible=!0},closeadd(){this.addvisible=!1},addcontainer(e){this.$refs[e].validate((e=>{if(!e)return console.log("表单验证不通过"),!1;this.cp_form.containerInfoList.push(JSON.parse(JSON.stringify(this.tmp_con_info))),this.addvisible=!1}))},handleClose(e){this.cp_form.containerInfoList.splice(this.cp_form.containerInfoList.indexOf(e),1)},openCreatePod(){this.createpodvisible=!0},getPodList(){this.$axios.get(this.baseurl+"/workload/getPodList").then((e=>{this.poddata=JSON.parse(e.data.result).items,this.poddata=this.poddata.filter((e=>this.$store.state.nodename===(e.spec.nodeName?e.spec.nodeName:"master1")));for(let t=0;t<this.poddata.length;t++)this.poddata[t].info={},this.poddata[t].spec.volumes?(this.poddata[t].info.ppname=this.poddata[t].spec.volumes[0].name,this.$axios.get(this.baseurl+"/virtuleStorage/pvPath?pvName="+this.poddata[t].spec.volumes[0].name).then((e=>{this.poddata[t].info.podpath=e.data.pvPath})).catch((e=>{console.log(this.poddata[t].spec.volumes[0].name+"无path")})),this.poddata[t].info.podpath||(this.poddata[t].info.podpath="---")):(this.poddata[t].info.ppname="---",this.poddata[t].info.podpath="---");this.totalpod=this.poddata.length})).catch((e=>{console.log("errors",e)}))},startPod(e,t){this.$axios({method:"post",url:this.baseurl+"/workload/startPod",data:{podName:t.metadata.name,podNamespace:t.metadata.namespace,podNodeName:t.spec.nodename,containerInfoList:[]},headers:{"Content-Type":"application/json"}}).then((e=>{console.log(e),this.$notify.success({title:"操作通知",message:"容器 "+t.metadata.name+" 启动成功",position:"bottom-right"}),t.metadata.annotations.status="Yes"}),(e=>{console.log(e),this.$notify.error({title:"操作失败",message:"请检查网络连接设置",position:"bottom-right"})}))},stopPod(e,t){this.$axios({method:"post",url:this.baseurl+"/workload/stopPod",data:{podName:t.metadata.name,podNamespace:t.metadata.namespace,podNodeName:t.spec.nodename,containerInfoList:[]},headers:{"Content-Type":"application/json"}}).then((e=>{console.log(e),this.$notify.success({title:"操作通知",message:"容器 "+t.metadata.name+" 停止成功",position:"bottom-right"}),t.metadata.annotations.status="No"}),(e=>{console.log(e),this.$notify.error({title:"操作失败",message:"请检查网络连接设置",position:"bottom-right"})}))},cp_sumbit(e){this.$refs[e].validate((e=>{if(!e)return console.log("表单验证不通过"),!1;{const e={podName:this.cp_form.podName,podNamespace:this.cp_form.namespace,podNodeName:this.cp_form.nodename,containerInfoList:this.cp_form.containerInfoList},t={pvcName:this.cp_form.pvcName};this.$axios({method:"post",url:this.baseurl+"/workload/createPod",data:{podInfo:e,pvcInfo:t},headers:{"Content-Type":"application/json"}}).then((e=>{console.log(e),"E"===e.data[0]?this.$notify.error({title:"创建失败",message:e.data,position:"bottom-right"}):(this.$notify.success({title:"完成通知",message:"容器 "+this.cp_form.podName+" 创建成功",position:"bottom-right"}),this.getPodList())}),(e=>{console.log(e),this.$notify.error({title:"创建失败",message:"请检查网络连接设置",position:"bottom-right"})})),this.createpodvisible=!1}}))},deletePod(e,t){this.$axios({method:"post",url:this.baseurl+"/workload/deletePod",data:{podName:t.metadata.name,podNamespace:t.metadata.namespace,podNodeName:t.spec.nodename,containerInfoList:[]},headers:{"Content-Type":"application/json"}}).then((e=>{this.$notify.success({title:"操作通知",message:"容器 "+t.metadata.name+"删除成功",position:"bottom-right"}),this.getPodList()}),(e=>{console.log(e),this.$notify.error({title:"删除失败",message:"请检查网络连接设置",position:"bottom-right"})}))},migrate_sumbit(e,t,a){console.log(a),this.$refs[a].validate((e=>{if(console.log(t.metadata.name),console.log(this.migrate_form.nodename),!e)return console.log("表单验证不通过"),!1;this.$axios({method:"post",url:this.baseurl+"/workload/editPod",data:{podName:t.metadata.name,podNamespace:t.metadata.namespace,podNodeName:this.migrate_form.nodename},headers:{"Content-Type":"application/json"}}).then((e=>{"E"===e.data[0]?this.$notify.error({title:"迁移失败",message:e.data,position:"bottom-right"}):this.$notify.success({title:"操作通知",message:"容器 "+t.metadata.name+"迁移成功",position:"bottom-right"}),this.getPodList()}),(e=>{console.log(e),this.$notify.error({title:"迁移失败",message:"请检查网络连接设置",position:"bottom-right"})}))}))},resetForm(e){this.$refs[e].resetFields()},nsremote(){this.$axios.get(this.baseurl+"/workload/namespace/list").then((e=>{console.log(JSON.parse(e.data.result));let t=JSON.parse(e.data.result).items,a=[];for(let o=0;o<t.length;o++){let e={};e["label"]=t[o].metadata.name,e["value"]=t[o].metadata.name,a.push(e)}this.namespace_options=a})).catch((e=>{console.log("errors",e)}))},noderemote(){this.$axios.get(this.baseurl+"/workload/node/list").then((e=>{console.log(JSON.parse(e.data.result));let t=JSON.parse(e.data.result).items,a=[];for(let o=0;o<t.length;o++){let e={};e["label"]=t[o].metadata.name,e["value"]=t[o].metadata.name,a.push(e)}this.nodename_options=a})).catch((e=>{console.log("errors",e)}))},pvcremote(){this.$axios.get(this.baseurl+"/virtuleStorage/vs/pvclist").then((e=>{console.log(e),console.log(JSON.parse(e.data.result));let t=JSON.parse(e.data.result).items,a=[];for(let o=0;o<t.length;o++){let e={};e["label"]=t[o].metadata.name,e["value"]=t[o].metadata.name,a.push(e)}this.pvcName_options=a})).catch((e=>{console.log("errors",e)}))},imageremote(){this.$axios.post(this.baseurl+"/containerd/images/list?nodeName="+this.$store.state.nodename,{virtualMachineIp:"39.98.124.97",userName:"root",userPassword:"Upc123456@"}).then((e=>{let t=this.data_resolver(e.data.result);console.log(t);let a=[];for(let o=0;o<t.length;o++){let e={};e["label"]=t[o].imageName+":"+t[o].imageTag,e["value"]=t[o].imageName+":"+t[o].imageTag,a.push(e)}this.containerImage_options=a})).catch((e=>{console.log("errors",e)}))},data_resolver(e){let t=[],a=e.split("\n"),o=1;for(;o<a.length-1;o++){let e=a[o].split(" ");e=e.filter((function(e){return""!==e})),t.push({imageName:e[0],imageTag:e[1],imageId:e[2],imageSize:e[3]})}return t}},computed:{tmp_nodename_w(){return this.$store.state.nodename}},watch:{tmp_nodename_w(e,t){this.getPodList()}}}),r=n,i=a(1001),l=(0,i.Z)(r,o,s,!1,null,null,null),p=l.exports}}]);
//# sourceMappingURL=878.94e8ad0a.js.map