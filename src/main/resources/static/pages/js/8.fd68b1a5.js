"use strict";(self["webpackChunkkfront"]=self["webpackChunkkfront"]||[]).push([[8],{82008:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var r=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{padding:"12px"}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.addResource}},[e._v(" 新增资源 ")]),t("el-button",{attrs:{type:"primary"},on:{click:e.addResourceByFile}},[e._v(" 文件上传资源 ")]),t("div",{staticStyle:{"font-size":"16px",display:"inline-block","margin-left":"12px"}},[e._v(" 选择资源类型： ")]),t("el-select",{staticStyle:{width:"180px"},attrs:{clearable:""},on:{change:e.fetchResourceData},model:{value:e.resourceId,callback:function(t){e.resourceId=t},expression:"resourceId"}},e._l(e.resourceTypeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{data:e.resourceData}},[t("el-table-column",{attrs:{prop:"id",label:"资源ID",width:"180"}}),t("el-table-column",{attrs:{prop:"name",label:"资源名称"}}),t("el-table-column",{attrs:{prop:"description",label:"资源描述"}}),t("el-table-column",{attrs:{prop:"attributes_values",label:"资源属性"},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(a.row.attributes_values,(function(a,r){return t("div",[t("span",[e._v(e._s(r)+"：")]),t("span",[e._v(e._s(a))])])}))}}])}),t("el-table-column",{attrs:{prop:"action",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-popconfirm",{attrs:{title:"是否确认删除该资源？"},on:{confirm:()=>e.confirmDelete(a.row)}},[t("el-button",{attrs:{slot:"reference",type:"danger",plain:""},slot:"reference"},[e._v("删除")])],1)]}}])})],1),t("el-drawer",{attrs:{visible:e.open,title:"新增资源",size:"40%","show-close":!1},on:{"update:visible":function(t){e.open=t}}},[t("div",{staticStyle:{position:"absolute",top:"10px",right:"10px"}},[t("el-button",{staticStyle:{"margin-right":"8px"},on:{click:e.onClose}},[e._v("取消")]),t("el-button",{attrs:{loading:e.submitLoading,type:"primary"},on:{click:e.submit}},[e._v("提交")])],1),t("el-form",{ref:"dynamicValidateForm",staticStyle:{padding:"10px"},attrs:{model:e.dynamicValidateForm,"label-width":"100px"}},[t("el-form-item",{attrs:{rules:{required:!0,message:"缺少资源名称"},label:"资源名称",prop:"name"}},[t("el-input",{model:{value:e.dynamicValidateForm.name,callback:function(t){e.$set(e.dynamicValidateForm,"name",t)},expression:"dynamicValidateForm.name"}})],1),t("el-form-item",{attrs:{rules:{required:!0,message:"缺少资源描述"},label:"资源描述",prop:"description"}},[t("el-input",{model:{value:e.dynamicValidateForm.description,callback:function(t){e.$set(e.dynamicValidateForm,"description",t)},expression:"dynamicValidateForm.description"}})],1),t("el-form-item",{attrs:{prop:"type_id",rules:{required:!0,message:"缺少资源属性类型"},label:"资源类型"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择资源属性类型"},model:{value:e.dynamicValidateForm.type_id,callback:function(t){e.$set(e.dynamicValidateForm,"type_id",t)},expression:"dynamicValidateForm.type_id"}},e._l(e.resourceTypeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e._l(e.resourceTypeAttributes,(function(a,r){return t("el-form-item",{key:r,attrs:{label:a.info,prop:["attributes_values",a.name].join("."),rules:[{required:!0,validator:(t,r)=>e.checkAttribute(r,a.data_type_name),trigger:"blur"}]}},["string"===a.data_type_name?t("el-input",{model:{value:e.dynamicValidateForm.attributes_values[a.name],callback:function(t){e.$set(e.dynamicValidateForm.attributes_values,a.name,t)},expression:"dynamicValidateForm.attributes_values[item.name]"}}):"int"===a.data_type_name||"float"===a.data_type_name||"double"===a.data_type_name||"long"===a.data_type_name?t("el-input-number",{staticStyle:{width:"100%"},model:{value:e.dynamicValidateForm.attributes_values[a.name],callback:function(t){e.$set(e.dynamicValidateForm.attributes_values,a.name,t)},expression:"dynamicValidateForm.attributes_values[item.name]"}}):"boolean"===a.data_type_name?t("el-input",{model:{value:e.dynamicValidateForm.attributes_values[a.name],callback:function(t){e.$set(e.dynamicValidateForm.attributes_values,a.name,t)},expression:"dynamicValidateForm.attributes_values[item.name]"}}):e._e()],1)}))],2)],1)],1)},i=[],s=a(59684),n=a(42325),o={name:"ResourceManage",data(){return{resourceData:[],resourceTypeData:[],dataType:[],tableLoading:!1,submitLoading:!1,open:!1,resourceFile:null,resourceId:"",dynamicValidateForm:{name:"",description:"",type_id:void 0,attributes_values:{}}}},computed:{resourceTypeOptions(){return this.resourceTypeData.map((e=>({label:e.resource_type.name,value:e.resource_type.id})))},resourceTypeAttributes(){const e=this.resourceTypeData.find((e=>e.resource_type.id===this.dynamicValidateForm.type_id));return e?.attributes||[]}},watch:{open(e){e&&(this.$refs.dynamicValidateForm?.resetFields(),this.dynamicValidateForm={name:"",description:"",type_id:void 0,attributes_values:{}})}},mounted(){const e=this.$route.query||{};this.getResourceTypeData(),e.resource_type_id?(this.resourceId=Number(e.resource_type_id),this.fetchResourceData()):this.getAllResourceData()},methods:{onClose(){this.open=!1},async fetchResourceData(){if(!this.resourceId)return this.getAllResourceData();this.tableLoading=!0;const e=await(0,s.PG)(this.resourceId).catch((e=>e));if(this.tableLoading=!1,!(0,n.d)(e))return this.$message.error(e.message||"请求失败");this.resourceData=e.data},async getAllResourceData(){this.tableLoading=!0;const e=await(0,s.A1)().catch((e=>e));if(this.tableLoading=!1,!(0,n.d)(e))return this.$message.error(e.message||"请求失败");this.resourceData=e.data},addResource(){this.open=!0,this.getResourceTypeData()},addResourceByFile(){this.resourceFile=!0},async getResourceTypeData(){this.tableLoading=!0;const e=await(0,s.XQ)().catch((e=>e));if(await this.getResourceDataType().catch((e=>e)),this.tableLoading=!1,!(0,n.d)(e))return this.$message.error(e.message||"请求失败");this.resourceTypeData=e.data?.map((e=>(e.attributes=e.attributes.map((e=>{const t=this.dataType.find((t=>t.id===e.data_type));return{...e,data_type_name:t?.name}})),e)))},async getResourceDataType(){const e=await(0,s.b3)().catch((e=>e));if(!(0,n.d)(e))return this.$message.error(e.message||"请求失败");this.dataType=e.data},async confirmDelete({id:e}){const t=await(0,s.fg)(e).catch((e=>e));if(!(0,n.d)(t))return this.$message.error(t.message||"请求失败");this.$message.success("删除成功"),this.getAllResourceData()},async checkAttribute(e,t){return e?"int"!==t||Number.isInteger(e)?"float"!==t&&"double"!==t||"number"===typeof e?"boolean"===t&&"true"!==e&&"false"!==e?Promise.reject("只能是布尔值，true或者false"):Promise.resolve():Promise.reject("只能是数字"):Promise.reject("只能是整数"):Promise.reject("必填")},async submit(){this.submitLoading=!0,this.$refs.dynamicValidateForm.validate((async e=>{if(!e)return this.submitLoading=!1;const{attributes_values:t,type_id:a,name:r,description:i}=this.dynamicValidateForm,o={name:r,description:i,type_id:a,attributes_values:t},u=await(0,s.SN)(o).catch((e=>e));if(!(0,n.d)(u))return this.submitLoading=!1,this.$message.error(u.message||"请求失败");this.submitLoading=!1,this.open=!1,this.$message.success("新增成功"),this.getAllResourceData()}))}}},u=o,l=a(1001),c=(0,l.Z)(u,r,i,!1,null,"ccfa655a",null),d=c.exports},59684:function(e,t,a){a.d(t,{A1:function(){return u},Jo:function(){return s},OE:function(){return m},PG:function(){return o},Qs:function(){return f},SN:function(){return l},XQ:function(){return i},b3:function(){return d},fC:function(){return n},fg:function(){return c},p2:function(){return p},w6:function(){return y}});var r=a(84471);const i=()=>(0,r.U)({url:"/resource/fetchAllResourceType",data:{}}),s=e=>(0,r.v)({url:"/resource/createResourceType",data:e}),n=e=>(0,r.v)({url:"/resource/deleteResourceType",params:{resource_type_id:e}}),o=e=>(0,r.U)({url:"/resource/fetchResource",data:{resource_type_id:e}}),u=()=>(0,r.U)({url:"/resource/fetchAllResources",data:{}}),l=e=>(0,r.v)({url:"/resource/createResource",data:e}),c=e=>(0,r.v)({url:"/resource/deleteResource",params:{resource_id:e}}),d=()=>(0,r.U)({url:"/dataType/fetchAllDataType",data:{}}),m=e=>(0,r.v)({url:"/dataType/createDataType",data:e}),p=e=>(0,r.v)({url:"/dataType/deleteDataType",params:{data_type_id:e}}),y=e=>(0,r.U)({url:"/relation/fetchTasksByResource",data:{resource_id:e}}),f=e=>(0,r.v)({url:"/relation/deleteTaskFromResource",data:e})},42325:function(e,t,a){a.d(t,{d:function(){return r}});const r=e=>200===e.code},84471:function(e,t,a){a.d(t,{U:function(){return n},v:function(){return o}});var r=a(44161);const i=r.Z.create({baseURL:"//81.70.164.10:8750/"});function s({url:e,data:t,method:a,config:r,params:s}){const n=e=>200===e.data.code?e.data:Promise.reject(e.data),o=e=>{throw new Error(e?.message||"Error")};if(a=a||"GET","GET"===a){const a=Object.assign("function"===typeof t?t():t??{},{});return i.get(e,{params:a,...r}).then(n,o)}if("POST"===a){if(t)return i.post(e,t,r).then(n,o);if(s)return i.post(e,null,{params:s,...r}).then(n,o)}}function n({url:e,data:t,method:a="GET"}){return s({url:e,method:a,data:t})}function o({url:e,data:t,params:a,method:r="POST"}){return s({url:e,method:r,params:a,data:t})}}}]);
//# sourceMappingURL=8.fd68b1a5.js.map