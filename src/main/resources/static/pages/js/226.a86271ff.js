"use strict";(self["webpackChunkkfront"]=self["webpackChunkkfront"]||[]).push([[226],{50226:function(e,t,a){a.r(t),a.d(t,{default:function(){return n}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"vmarea"},[t("el-row",{attrs:{gutter:0}},[t("el-col",{attrs:{span:10,offset:0}},[t("p",{staticStyle:{"font-size":"25px","font-weight":"600","margin-bottom":"20px"}},[e._v(" 持久卷列表 ")])]),t("el-col",{attrs:{span:2,offset:12}},[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"medium",round:"",plain:""},on:{click:e.openCreateVirStore}},[e._v("创建持久卷")])],1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.vsdata.slice((e.curpage-1)*e.pagesize,e.curpage*e.pagesize).filter((t=>!e.psearch||t.metadata.name.toLowerCase().includes(e.psearch.toLowerCase()))),"empty-text":"暂无持久卷","header-cell-style":{background:"#00b8a9",color:"#fff"}}},[t("el-table-column",{attrs:{label:"序号",type:"index"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"持久卷名",prop:"metadata.name"}}),t("el-table-column",{attrs:{width:"100",sortable:"",label:"容量",prop:"spec.capacity.storage"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"访问模式",prop:"spec.accessModes"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"回收策略",prop:"spec.persistentVolumeReclaimPolicy"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"状态",prop:"status.phase"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"声明",prop:"spec.claimRef.name"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"主机路径",prop:"spec.hostPath.path"}}),t("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-popover",{ref:"popover"+a.$index,attrs:{placement:"right",width:"300",trigger:"click"}},[t("el-form",{ref:"editform",attrs:{"label-position":"top","label-width":"80px",model:e.editform,"status-icon":!0,rules:e.edit_rules}},[t("el-form-item",{attrs:{label:"容量大小",prop:"vol"}},[t("el-input",{attrs:{placeholder:"请输入要修改的容量大小",size:"normal",clearable:""},model:{value:e.editform.vol,callback:function(t){e.$set(e.editform,"vol",t)},expression:"editform.vol"}},[t("template",{slot:"append"},[e._v("GiB")])],2)],1),t("el-form-item",{attrs:{size:"large"}},[t("div",{staticStyle:{"text-align":"right"}},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.edit_submit(a.$index,a.row,"editform")}}},[e._v("确定修改")])],1)])],1)],1),t("div",{staticStyle:{"text-align":"center"}},[t("el-button-group",[t("el-button",{directives:[{name:"popover",rawName:"v-popover",value:"popover"+a.$index,expression:"'popover' + scope.$index"}],attrs:{plain:"",type:"info"}},[e._v("修改")]),t("el-button",{attrs:{plain:"",type:"danger"},on:{click:function(t){return e.deletePerV(a.$index,a.row)}}},[e._v("删除")])],1)],1)]}}])},[t("template",{slot:"header"},[t("el-input",{attrs:{size:"mini",placeholder:"输入名称搜索"},model:{value:e.psearch,callback:function(t){e.psearch=t},expression:"psearch"}})],1)],2)],1),0!=e.vsdata.length?t("div",{staticStyle:{"margin-top":"30px"}},[t("el-pagination",{attrs:{"current-page":e.curpage,"page-sizes":[10,20,30,40,50],"page-size":e.pagesize,layout:"sizes, total, prev, pager, next, jumper",total:e.totalvs,background:""},on:{"update:currentPage":function(t){e.curpage=t},"update:current-page":function(t){e.curpage=t},"update:pageSize":function(t){e.pagesize=t},"update:page-size":function(t){e.pagesize=t}}})],1):e._e(),t("el-dialog",{attrs:{title:"创建持久卷",visible:e.createVirstoreVisible},on:{"update:visible":function(t){e.createVirstoreVisible=t}}},[t("el-form",{ref:"vs_form",attrs:{"label-position":"top","label-width":"80px",model:e.vs_form,"status-icon":!0,rules:e.vs_rules}},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"持久卷名称",prop:"pvInfo.pvName"}},[t("el-input",{attrs:{placeholder:"请输入持久卷名称"},model:{value:e.vs_form.pvInfo.pvName,callback:function(t){e.$set(e.vs_form.pvInfo,"pvName",t)},expression:"vs_form.pvInfo.pvName"}})],1)],1),t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"持久卷声明名称",prop:"pvcInfo.pvcName"}},[t("el-input",{attrs:{placeholder:"请输入持久卷声明名称"},model:{value:e.vs_form.pvcInfo.pvcName,callback:function(t){e.$set(e.vs_form.pvcInfo,"pvcName",t)},expression:"vs_form.pvcInfo.pvcName"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"持久卷主机地址",prop:"pvInfo.pvPath"}},[t("el-input",{attrs:{placeholder:"请输入持久卷主机地址"},model:{value:e.vs_form.pvInfo.pvPath,callback:function(t){e.$set(e.vs_form.pvInfo,"pvPath",t)},expression:"vs_form.pvInfo.pvPath"}})],1)],1),t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"持久卷声明命名空间",prop:"pvcInfo.pvcNamespace"}},[t("el-input",{attrs:{placeholder:"请输入持久卷声明命名空间"},model:{value:e.vs_form.pvcInfo.pvcNamespace,callback:function(t){e.$set(e.vs_form.pvcInfo,"pvcNamespace",t)},expression:"vs_form.pvcInfo.pvcNamespace"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"持久卷容量",prop:"pvInfo.pvQuantity"}},[t("el-input",{attrs:{placeholder:"请输入持久卷容量"},model:{value:e.vs_form.pvInfo.pvQuantity,callback:function(t){e.$set(e.vs_form.pvInfo,"pvQuantity",t)},expression:"vs_form.pvInfo.pvQuantity"}})],1)],1),t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"持久卷声明容量",prop:"pvcInfo.pvcQuantity"}},[t("el-input",{attrs:{placeholder:"请输入持久卷声明容量"},model:{value:e.vs_form.pvcInfo.pvcQuantity,callback:function(t){e.$set(e.vs_form.pvcInfo,"pvcQuantity",t)},expression:"vs_form.pvcInfo.pvcQuantity"}})],1)],1)],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"持久卷访问模式",prop:"pvInfo.pvAccessMode"}},[t("el-input",{attrs:{placeholder:"请输入持久卷访问模式"},model:{value:e.vs_form.pvInfo.pvAccessMode,callback:function(t){e.$set(e.vs_form.pvInfo,"pvAccessMode",t)},expression:"vs_form.pvInfo.pvAccessMode"}})],1)],1),t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"所在节点",prop:"pvInfo.pvNodeName"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择持久卷所在节点"},on:{"visible-change":e.noderemote},model:{value:e.vs_form.pvInfo.pvNodeName,callback:function(t){e.$set(e.vs_form.pvInfo,"pvNodeName",t)},expression:"vs_form.pvInfo.pvNodeName"}},e._l(e.nodename_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-form-item",{attrs:{size:"large"}},[t("div",{staticStyle:{"text-align":"right","padding-top":"30px"}},[t("el-button",{attrs:{round:""},on:{click:function(t){return e.resetForm("vs_form")}}},[e._v("清空输入")]),t("el-button",{attrs:{round:"",type:"primary"},on:{click:function(t){return e.vs_sumbit("vs_form")}}},[e._v("立即创建")])],1)])],1)],1)],1)},o=[],r=(a(70560),{name:"ImageList",mounted(){this.getPerVList()},data(){return{baseurl:"http://39.98.124.97:8080",vsdata:[],psearch:"",curpage:1,totalvs:0,pagesize:10,createVirstoreVisible:!1,nodename_options:[],editform:{vol:""},vs_form:{vmInfo:{virtualMachineIp:"39.98.124.97",userName:"root",userPassword:"Upc123456@"},pvInfo:{pvName:"example-pv1",pvPath:"/opt/disks/vol2",pvQuantity:"10Gi",pvAccessMode:"ReadWriteOnce"},pvcInfo:{pvcName:"example-pvc1",pvcNamespace:"default",pvcQuantity:"8Gi"}},edit_rules:{vol:{required:!0,message:"请输入要修改的容量大小",trigger:"blur"}},vs_rules:{pvInfo:{pvName:{required:!0,message:"请输入持久卷名称",trigger:"blur"},pvPath:{required:!0,message:"请输入持久卷主机地址",trigger:"blur"},pvQuantity:{required:!0,message:"请输入持久卷容量",trigger:"blur"},pvAccessMode:{required:!0,message:"请输入持久卷访问模式",trigger:"blur"},pvNodeName:{required:!0,message:"请选择持久卷所在节点",trigger:"change"}},pvcInfo:{pvcName:{required:!0,message:"请输入持久卷声明名称",trigger:"blur"},pvcNamespace:{required:!0,message:"请输入持久卷声明命名空间",trigger:"blur"},pvcQuantity:{required:!0,message:"请输入持久卷声明容量",trigger:"blur"}}}}},methods:{noderemote(){this.$axios.get(this.baseurl+"/node/getNodeList1").then((e=>{let t=e.data.content,a=[];for(let s=0;s<t.length;s++){let e={};e["label"]=t[s].nodeName,e["value"]=t[s].nodeName,a.push(e)}this.nodename_options=a})).catch((e=>{console.log("errors",e)}))},edit_submit(e,t,a){console.log(a),this.$refs[a].validate((t=>{if(!t)return console.log("表单验证不通过"),!1;this.$axios({method:"post",url:this.baseurl+"/virtuleStorage/updateVs",data:{pvName:this.vsdata[e].metadata.name,pvPath:this.vsdata[e].spec.hostPath.path,pvQuantity:this.editform.vol+"Gi",pvAccessMode:this.vsdata[e].spec.accessModes[0]},headers:{"Content-Type":"application/json"}}).then((t=>{console.log(t),"F"===t.data[0]?this.$notify.error({title:"修改失败",message:t.data,position:"bottom-right"}):(this.$notify.success({title:"操作通知",message:"持久卷 "+this.vsdata[e].metadata.name+" 修改容量成功",position:"bottom-right"}),this.editform.vol=""),this.getPerVList()}),(e=>{console.log(e),this.$notify.error({title:"修改失败",message:"请检查网络连接设置",position:"bottom-right"}),this.getPerVList()})),this.createVirstoreVisible=!1}))},vs_sumbit(e){this.$refs[e].validate((e=>{if(!e)return console.log("表单验证不通过"),!1;this.$axios({method:"post",url:this.baseurl+"/virtuleStorage/createVs",data:this.vs_form,headers:{"Content-Type":"application/json"}}).then((e=>{console.log(e),"F"===e.data[0]?this.$notify.error({title:"创建失败",message:e.data,position:"bottom-right"}):this.$notify.success({title:"完成通知",message:"持久卷 "+this.vs_form.pvInfo.pvName+" 创建成功",position:"bottom-right"}),this.getPerVList()}),(e=>{console.log(e),this.$notify.error({title:"创建失败",message:"请检查网络连接设置",position:"bottom-right"})})),this.createVirstoreVisible=!1}))},getPerVList(){this.$axios.get(this.baseurl+"/virtuleStorage/vs/list").then((e=>{this.vsdata=JSON.parse(e.data.result).items;let t=[];for(let a=0;a<this.vsdata.length;a++){let s=0;for(let o=0;o<e.data.pvList.length;o++)this.vsdata[a].metadata.name===e.data.pvList[o].pvName&&(s=1,this.$store.state.nodename===e.data.pvList[o].pvNodeName&&(t.push(this.vsdata[a]),o=e.data.pvList.length));0==s&&"master1"===this.$store.state.nodename&&t.push(this.vsdata[a])}this.vsdata=t,this.totalvs=this.vsdata.length})).catch((e=>{console.log("errors",e)}))},openCreateVirStore(){this.createVirstoreVisible=!0},deletePerV(e,t){this.$axios({method:"post",url:this.baseurl+"/virtuleStorage/deleteVs",data:{pvName:this.vsdata[e].metadata.name,pvPath:this.vsdata[e].spec.hostPath.path,pvQuantity:this.vsdata[e].spec.capacity.storage,pvAccessMode:this.vsdata[e].spec.accessModes[0]},headers:{"Content-Type":"application/json"}}).then((e=>{"F"===e.data[0]?this.$notify.error({title:"删除失败",message:e.data,position:"bottom-right"}):this.$notify.success({title:"操作通知",message:"持久卷 "+this.vs_form.pvInfo.pvName+" 删除成功",position:"bottom-right"}),this.getPerVList()}),(e=>{console.log(e),this.$notify.error({title:"删除失败",message:"请检查网络连接设置",position:"bottom-right"}),this.getPerVList()}))},resetForm(e){this.$refs[e].resetFields()}},computed:{tmp_nodename_w(){return this.$store.state.nodename}},watch:{tmp_nodename_w(e,t){this.getPerVList()}}}),i=r,l=a(1001),p=(0,l.Z)(i,s,o,!1,null,null,null),n=p.exports}}]);
//# sourceMappingURL=226.a86271ff.js.map