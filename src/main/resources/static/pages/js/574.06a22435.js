"use strict";(self["webpackChunkkfront"]=self["webpackChunkkfront"]||[]).push([[574],{83574:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});var s=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.resloading,expression:"resloading"}],attrs:{"element-loading-text":"资源汇聚中。。。"}},[t("div",{staticStyle:{"font-size":"30px",color:"#3d3d3d","font-weight":"600","padding-left":"20px","padding-bottom":"20px","padding-top":"30px"}},[e._v(" 资源汇聚- 资源汇聚时间： "),0!=e.endTime?t("span",[e._v(" "+e._s((e.endTime-e.beginTime)/1e3)+" 秒")]):t("span",[e._v("资源汇聚中。。。")])]),t("div",{staticClass:"vmarea"},[t("div",{staticStyle:{"font-size":"30px","font-weight":"600","margin-bottom":"20px"}},[e._v(" 节点信息 ")]),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.nodeinfo,"empty-text":"暂无节点信息","header-cell-style":{background:"#00b8a9",color:"#fff"}}},[t("el-table-column",{attrs:{width:"100",type:"index",label:"序号"}}),t("el-table-column",{attrs:{sortable:"",prop:"nodeName",label:"节点名称",width:"300"}}),t("el-table-column",{attrs:{sortable:"",prop:"nodeIp",label:"节点IP",width:"400"}}),t("el-table-column",{attrs:{sortable:"",prop:"nodeStatus",label:"节点状态",width:"200"}}),t("el-table-column",{attrs:{sortable:"",prop:"nodeLocation",label:"节点位置",width:"200"}}),t("el-table-column",{attrs:{sortable:"",prop:"nodeType",label:"节点类型",width:"180"},scopedSlots:e._u([{key:"default",fn:function(a){return["云"===a.row.nodeType?t("el-tag",{attrs:{type:"success",effect:"dark"}},[e._v("云节点")]):"边"===a.row.nodeType?t("el-tag",{attrs:{type:"primary",effect:"dark"}},[e._v("边节点")]):"端"===a.row.nodeType?t("el-tag",{attrs:{type:"warning",effect:"dark"}},[e._v("端节点")]):t("el-tag",{attrs:{type:"info",effect:"dark"}},[e._v(e._s(a.row.nodeType)+"节点")])]}}])}),t("el-table-column",{attrs:{sortable:"",prop:"nodeConnectivity",label:"是否连接"},scopedSlots:e._u([{key:"default",fn:function(a){return[1===a.row.nodeConnectivity?t("el-tag",{attrs:{type:"success"}},[e._v("已连接")]):t("el-tag",{attrs:{type:"danger"}},[e._v("未连接")])]}}])})],1)],1),t("div",{staticClass:"vmarea"},[t("el-dialog",{attrs:{title:"创建虚拟机",visible:e.buildvmvisible},on:{"update:visible":function(t){e.buildvmvisible=t}}},[t("el-form",{ref:"formData",attrs:{"label-position":"top","label-width":"80px",model:e.formData,"status-icon":!0,rules:e.vm_rules}},[t("el-row",{attrs:{gutter:30}},[t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"虚拟机名称",prop:"name"}},[t("el-input",{staticStyle:{width:"60%"},attrs:{placeholder:"请输入虚拟机名称"},on:{blur:function(t){return e.validName()}},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1)],1),t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"内存",prop:"memory"}},[t("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",placeholder:"请选择内存大小(GiB)"},model:{value:e.formData.memory,callback:function(t){e.$set(e.formData,"memory",t)},expression:"formData.memory"}},e._l(e.memory_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:30}},[t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"CPU个数",prop:"cpuNum"}},[t("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",placeholder:"请选择CPU个数"},model:{value:e.formData.cpuNum,callback:function(t){e.$set(e.formData,"cpuNum",t)},expression:"formData.cpuNum"}},e._l(e.cpunum_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"系统类型",prop:"OStype"}},[t("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",placeholder:"请选择系统类型"},model:{value:e.formData.OStype,callback:function(t){e.$set(e.formData,"OStype",t)},expression:"formData.OStype"}},e._l(e.ostype_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:30}},[t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"虚拟机镜像,#仅支持qcow2格式",prop:"ImgName"}},[t("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",placeholder:"请选择虚拟机镜像"},on:{"visible-change":e.nsremote},model:{value:e.formData.ImgName,callback:function(t){e.$set(e.formData,"ImgName",t)},expression:"formData.ImgName"}},e._l(e.images,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"节点",prop:"node"}},[t("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",placeholder:"请选择创建虚拟机所在宿主机节点"},model:{value:e.formData.node,callback:function(t){e.$set(e.formData,"node",t)},expression:"formData.node"}},e._l(e.node_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:30}},[t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"网络类型",prop:"nettype"}},[t("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",placeholder:"请选择创建虚拟机的网络类型"},model:{value:e.formData.nettype,callback:function(t){e.$set(e.formData,"nettype",t)},expression:"formData.nettype"}},e._l(e.nettype_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-form-item",{attrs:{size:"large"}},[t("div",{staticClass:"vmc-sbm-area"},[t("el-button",{attrs:{round:""},on:{click:function(t){return e.resetForm("formData")}}},[e._v("清空输入")]),t("el-button",{attrs:{round:"",type:"primary"},on:{click:function(t){return e.vmc_sumbit("formData")}}},[e._v("立即创建")])],1)])],1)],1),t("el-dialog",{attrs:{title:"执行命令",visible:e.commandvisible},on:{"update:visible":function(t){e.commandvisible=t}}},[t("el-descriptions",{attrs:{title:"虚拟机信息"}},[t("el-descriptions-item",{attrs:{label:"名称"}},[e._v(e._s(this.command_tmp_data.name))]),t("el-descriptions-item",{attrs:{label:"状态"}},["VIR_DOMAIN_PAUSED"===this.command_tmp_data.state?t("el-tag",{attrs:{type:"warning"}},[e._v("挂起")]):"VIR_DOMAIN_RUNNING"===this.command_tmp_data.state?t("el-tag",[e._v("运行")]):t("el-tag",{attrs:{type:"danger"}},[e._v("关机")])],1),t("el-descriptions-item",{attrs:{label:"cpu个数"}},[e._v(e._s(this.command_tmp_data.cpuNum))]),t("el-descriptions-item",{attrs:{label:"分配内存(GiB)"}},[e._v(e._s(this.command_tmp_data.maxMem))]),t("el-descriptions-item",{attrs:{label:"IP地址"}},[e._v(e._s(this.command_tmp_data.ipaddr))])],1),t("el-form",{ref:"commandForm",attrs:{"label-position":"top","label-width":"80px",model:e.commandForm,"status-icon":!0,rules:e.command_rules}},[t("el-form-item",{attrs:{label:"命令",prop:"command"}},[t("el-input",{attrs:{placeholder:"请输入要执行的命令",type:"textarea",rows:4,clearable:""},model:{value:e.commandForm.command,callback:function(t){e.$set(e.commandForm,"command",t)},expression:"commandForm.command"}})],1),t("el-form-item",{attrs:{prop:"result"}},[t("template",{slot:"label"},[e._v(" 执行结果 ")]),t("el-input",{attrs:{placeholder:"命令执行的结果将会显示在这里",type:"textarea",rows:4,clearable:""},model:{value:e.commandForm.result,callback:function(t){e.$set(e.commandForm,"result",t)},expression:"commandForm.result"}})],2),t("el-form-item",{attrs:{prop:"res_state"}},[t("div",{staticStyle:{float:"right"}},["yes"===this.commandForm.res_state?t("span",{staticStyle:{color:"#67c23a","font-size":"15px"}},[t("i",{staticClass:"el-icon-success"}),e._v("执行成功")]):e._e(),"no"===this.commandForm.res_state?t("span",{staticStyle:{color:"#f56c6c","font-size":"15px"}},[t("i",{staticClass:"el-icon-error"}),e._v("执行出错")]):e._e()])]),t("el-form-item",{attrs:{size:"large"}},[t("div",{staticClass:"vmc-sbm-area",staticStyle:{"text-align":"right","margin-top":"50px"}},[t("el-button",{attrs:{round:""},on:{click:function(t){return e.resetForm("commandForm")}}},[e._v("清空输入")]),t("el-button",{attrs:{round:"",type:"primary"},on:{click:function(t){return e.start_command("commandForm")}}},[e._v("立即执行")])],1)])],1)],1),t("el-drawer",{directives:[{name:"loading",rawName:"v-loading",value:e.fullloading,expression:"fullloading"}],attrs:{visible:e.imagedrawer,direction:"ttb",size:"90%"},on:{"update:visible":function(t){e.imagedrawer=t},open:e.imgdopen}},[t("div",{attrs:{slot:"title"},slot:"title"},[t("el-row",{attrs:{gutter:0}},[t("el-col",{attrs:{span:5,offset:0}},[t("p",{staticStyle:{"font-size":"25px","font-weight":"600","margin-bottom":"0px"}},[e._v(" "+e._s(e.vmimg_tmp_data.name)+"-容器镜像列表 ")])]),t("el-col",{attrs:{span:3,offset:0}},[t("el-select",{staticStyle:{width:"80%"},attrs:{clearable:"",placeholder:"请选择要上传的镜像"},on:{"visible-change":e.getimg},model:{value:e.iamgename,callback:function(t){e.iamgename=t},expression:"iamgename"}},e._l(e.img_list,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-col",{attrs:{span:2,offset:0}},[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"medium",round:"",plain:""},on:{click:e.uploadImgToVm}},[e._v("上传镜像到虚拟机")])],1)],1)],1),t("div",{staticStyle:{"margin-left":"20px","margin-right":"20px"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.cidata.filter((t=>!e.pcisearch||t.repository.toLowerCase().includes(e.pcisearch.toLowerCase()))),height:"700","empty-text":"暂无容器镜像","header-cell-style":{background:"#00b8a9",color:"#fff"}}},[t("el-table-column",{attrs:{width:"80",type:"index",label:"序号"}}),t("el-table-column",{attrs:{width:"500",sortable:"",label:"仓库/镜像名",prop:"repository"}}),t("el-table-column",{attrs:{width:"300",sortable:"",label:"标签",prop:"tag"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"镜像ID",prop:"imageid"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"创建时间",prop:"created"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"体积",prop:"size"}}),t("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticStyle:{"text-align":"center"}},[t("el-button",{attrs:{plain:"",type:"success"},on:{click:function(t){return e.startimage(a.$index,a.row)}}},[e._v("启动镜像")]),t("el-button",{attrs:{plain:"",type:"danger"},on:{click:function(t){return e.deleteimage(a.$index,a.row)}}},[e._v("删除")])],1)]}}])},[t("template",{slot:"header"},[t("el-input",{attrs:{size:"mini",placeholder:"输入名称搜索"},model:{value:e.pcisearch,callback:function(t){e.pcisearch=t},expression:"pcisearch"}})],1)],2)],1)],1)]),t("el-drawer",{directives:[{name:"loading",rawName:"v-loading",value:e.fullloading,expression:"fullloading"}],attrs:{visible:e.poddrawer,direction:"ttb",size:"90%"},on:{"update:visible":function(t){e.poddrawer=t},open:e.podopen}},[t("div",{attrs:{slot:"title"},slot:"title"},[t("el-row",{attrs:{gutter:0}},[t("el-col",{attrs:{span:5,offset:0}},[t("p",{staticStyle:{"font-size":"25px","font-weight":"600","margin-bottom":"0px"}},[e._v(" "+e._s(e.vmpod_tmp_data.name)+"-容器列表 ")])])],1)],1),t("div",{staticStyle:{"margin-left":"20px","margin-right":"20px"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.poddata.filter((t=>!e.ppodsearch||t.image.toLowerCase().includes(e.ppodsearch.toLowerCase()))),height:"700","empty-text":"暂无容器","header-cell-style":{background:"#00b8a9",color:"#fff"}}},[t("el-table-column",{attrs:{width:"80",type:"index",label:"序号"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"容器ID",prop:"conid"}}),t("el-table-column",{attrs:{width:"300",sortable:"",label:"镜像",prop:"image"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"命令",prop:"command"}}),t("el-table-column",{attrs:{width:"300",sortable:"",label:"创建时间",prop:"created"}}),t("el-table-column",{attrs:{width:"300",sortable:"",label:"状态",prop:"status"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"名字",prop:"names"}}),t("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticStyle:{"text-align":"center"}},[t("el-button-group",[t("el-button",{attrs:{plain:"",type:"success"},on:{click:function(t){return e.startpod(a.$index,a.row)}}},[e._v("启动")]),t("el-button",{attrs:{plain:"",type:"warning"},on:{click:function(t){return e.stoppod(a.$index,a.row)}}},[e._v("停止")]),t("el-button",{attrs:{plain:"",type:"danger"},on:{click:function(t){return e.deletepod(a.$index,a.row)}}},[e._v("删除")])],1)],1)]}}])},[t("template",{slot:"header"},[t("el-input",{attrs:{size:"mini",placeholder:"输入名称搜索"},model:{value:e.ppodsearch,callback:function(t){e.ppodsearch=t},expression:"ppodsearch"}})],1)],2)],1)],1)]),t("el-row",{attrs:{gutter:0}},[t("el-col",{attrs:{span:10,offset:0}},[t("p",{staticStyle:{"font-size":"25px","font-weight":"600","margin-bottom":"20px"}},[e._v(" 虚拟机列表 ")])]),t("el-col",{attrs:{span:3,offset:13}},[t("el-button",{attrs:{icon:"el-icon-refresh",size:"medium",round:"",plain:""},on:{click:e.refreshIP}},[e._v("更新虚拟机ip地址 ")])],1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.vmdata.slice((e.curpage-1)*e.pagesize,e.curpage*e.pagesize).filter((t=>!e.psearch||t.name.toLowerCase().includes(e.psearch.toLowerCase()))),"empty-text":"暂无虚拟机","header-cell-style":{background:"#00b8a9",color:"#fff"}}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),t("el-table-column",{attrs:{width:"150",sortable:"",label:"名称",prop:"name"}}),t("el-table-column",{attrs:{width:"100",sortable:"",label:"状态",prop:"state"},scopedSlots:e._u([{key:"default",fn:function(a){return["VIR_DOMAIN_PAUSED"===a.row.state?t("el-tag",{attrs:{type:"warning"}},[e._v("挂起")]):"VIR_DOMAIN_RUNNING"===a.row.state?t("el-tag",[e._v("运行")]):t("el-tag",{attrs:{type:"danger"}},[e._v("关机")])]}}])}),t("el-table-column",{attrs:{width:"100",sortable:"",label:"cpu个数",prop:"cpuNum"}}),t("el-table-column",{attrs:{width:"140",sortable:"",label:"分配内存(GiB)",prop:"maxMem"}}),t("el-table-column",{attrs:{width:"180",sortable:"",label:"IP地址",prop:"ipaddr"}}),t("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button-group",[t("el-button",{attrs:{plain:"",type:"success"},on:{click:function(t){return e.vmstart(a.row)}}},[e._v("启动")]),t("el-button",{attrs:{plain:"",type:"warning"},on:{click:function(t){return e.vmsuspend(a.row)}}},[e._v("挂起")]),t("el-button",{attrs:{plain:"",type:"success"},on:{click:function(t){return e.vmresume(a.row)}}},[e._v("还原")]),t("el-button",{attrs:{plain:"",type:"primary"},on:{click:function(t){return e.vmreboot(a.row)}}},[e._v("重启")]),t("el-button",{attrs:{plain:"",type:"info"},on:{click:function(t){return e.vmshutdown(a.row)}}},[e._v("关闭")]),t("el-button",{attrs:{plain:"",type:"danger"},on:{click:function(t){return e.vmshutdownMust(a.row)}}},[e._v("强制关闭")]),t("el-button",{attrs:{plain:"",type:"danger"},on:{click:function(t){return e.vmdelete(a.row)}}},[e._v("删除")]),t("el-button",{attrs:{plain:"",type:"primary"},on:{click:function(t){return e.openpod(a.row)}}},[e._v("容器管理")]),t("el-button",{attrs:{plain:"",type:"primary"},on:{click:function(t){return e.openimage(a.row)}}},[e._v("镜像管理")])],1)]}}])},[t("template",{slot:"header"},[t("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"输入名称搜索"},model:{value:e.psearch,callback:function(t){e.psearch=t},expression:"psearch"}})],1)],2)],1),0!=e.vmdata.length?t("div",{staticStyle:{"margin-top":"30px"}},[t("el-pagination",{attrs:{"current-page":e.curpage,"page-sizes":[10,20,30,40,50],"page-size":e.pagesize,layout:"sizes, total, prev, pager, next, jumper",total:e.totalvm,background:""},on:{"update:currentPage":function(t){e.curpage=t},"update:current-page":function(t){e.curpage=t},"update:pageSize":function(t){e.pagesize=t},"update:page-size":function(t){e.pagesize=t}}})],1):e._e()],1),t("div",{staticClass:"vmarea"},[t("el-row",{attrs:{gutter:0}},[t("el-col",{attrs:{span:10,offset:0}},[t("p",{staticStyle:{"font-size":"25px","font-weight":"600","margin-bottom":"20px"}},[e._v(" Pod列表 ")])]),t("el-col",{attrs:{span:2,offset:12}},[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"medium",round:"",plain:""},on:{click:e.openCreatePod}},[e._v("添加容器")])],1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.poddata.slice((e.pod_curpage-1)*e.pod_pagesize,e.pod_curpage*e.pod_pagesize).filter((t=>!e.pod_psearch||t.metadata.name.toLowerCase().includes(e.psearch.toLowerCase()))),"empty-text":"暂无Pod","header-cell-style":{background:"#00b8a9",color:"#fff"}}},[t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[t("el-form-item",{attrs:{label:"Pod名称"}},[t("span",[e._v(e._s(a.row.metadata.name))])]),t("el-form-item",{attrs:{label:"命名空间"}},[t("span",[e._v(e._s(a.row.metadata.namespace))])]),t("el-form-item",{attrs:{label:"节点"}},[t("span",[e._v(e._s(a.row.spec.nodeName))])]),t("el-form-item",{attrs:{label:"状态"}},[t("span",["Pending"===a.row.status.phase?t("el-tag",{attrs:{type:"warning"}},[e._v("挂起")]):"Running"===a.row.status.phase?t("el-tag",[e._v("运行")]):t("el-tag",{attrs:{type:"success"}},[e._v("成功")])],1)]),t("el-form-item",{attrs:{label:"是否可用"}},[t("span",["Yes"===a.row.metadata.annotations.status?t("el-tag",{attrs:{type:"success"}},[e._v("可用")]):t("el-tag",{attrs:{type:"danger"}},[e._v("不可用")])],1)]),t("el-form-item",{attrs:{label:"创建时间"}},[t("div",[t("span",[e._v(e._s(e.formatDate(a.row.metadata.creationTimestamp,"YYYY-MM-DD")))]),t("br"),t("span",[e._v(e._s(e.formatDate(a.row.metadata.creationTimestamp,"HH:mm:ss")))])])]),t("el-form-item",{attrs:{label:"容器列表"}}),t("el-form-item",{attrs:{label:"路径"}},[t("div",[e._v(" "+e._s(a.row.info.ppname)+":"+e._s(a.row.info.podpath)+" ")])]),t("el-table",{staticStyle:{width:"90%"},attrs:{size:"small",data:a.row.spec.containers}},[t("el-table-column",{attrs:{type:"index"}}),t("el-table-column",{attrs:{prop:"name",label:"容器名称",width:"200"}}),t("el-table-column",{attrs:{prop:"image",label:"容器镜像",width:"400"}}),t("el-table-column",{attrs:{prop:"ports",label:"端口号"},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(a.row.ports,(function(a){return t("el-tag",{key:a,attrs:{type:"info"}},[e._v(e._s(a.name+"/"+a.protocol+"/"+a.containerPort))])}))}}],null,!0)})],1)],1)]}}])}),t("el-table-column",{attrs:{type:"index",label:"序号"}}),t("el-table-column",{attrs:{width:"280",sortable:"",label:"Pod名称",prop:"metadata.name"}}),t("el-table-column",{attrs:{width:"300",sortable:"",label:"镜像",prop:"spec.containers[0].image"}}),t("el-table-column",{attrs:{width:"150",sortable:"",label:"命名空间",prop:"metadata.namespace"}}),t("el-table-column",{attrs:{sortable:"",label:"节点",prop:"spec.nodeName"}}),t("el-table-column",{attrs:{width:"100",sortable:"",label:"状态",prop:"status.phase"},scopedSlots:e._u([{key:"default",fn:function(a){return["Pending"===a.row.status.phase?t("el-tag",{attrs:{type:"warning"}},[e._v("挂起")]):"Running"===a.row.status.phase?t("el-tag",[e._v("运行")]):t("el-tag",{attrs:{type:"success"}},[e._v("成功")])]}}])}),t("el-table-column",{attrs:{width:"100",sortable:"",label:"是否可用",prop:"metadata.annotations.status"},scopedSlots:e._u([{key:"default",fn:function(a){return["Yes"===a.row.metadata.annotations.status?t("el-tag",{attrs:{type:"success"}},[e._v("可用")]):t("el-tag",{attrs:{type:"danger"}},[e._v("不可用")])]}}])}),t("el-table-column",{attrs:{sortable:"",label:"创建时间",prop:"metadata.creationTimestamp"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",[t("span",[e._v(e._s(e.formatDate(a.row.metadata.creationTimestamp,"YYYY-MM-DD")))]),t("br"),t("span",[e._v(e._s(e.formatDate(a.row.metadata.creationTimestamp,"HH:mm:ss")))])])]}}])}),t("el-table-column",{attrs:{width:"210",align:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-popover",{ref:"popover"+a.$index,attrs:{placement:"left",width:"300",trigger:"click"}},[t("el-form",{ref:"migrate_form"+a.$index,attrs:{"label-position":"top","label-width":"80px",model:e.migrate_form,"status-icon":!0,rules:e.migrate_rules}},[t("el-form-item",{attrs:{label:"请选择要迁移的节点",prop:"nodename"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择要迁移的节点"},on:{"visible-change":e.noderemote},model:{value:e.migrate_form.nodename,callback:function(t){e.$set(e.migrate_form,"nodename",t)},expression:"migrate_form.nodename"}},e._l(e.nodename_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{size:"large"}},[t("div",{staticStyle:{"text-align":"right"}},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.migrate_sumbit(a.$index,a.row,"migrate_form"+a.$index)}}},[e._v("确定迁移")])],1)])],1)],1),t("el-button-group",[t("el-button",{directives:[{name:"popover",rawName:"v-popover",value:"popover"+a.$index,expression:"'popover' + scope.$index"}],attrs:{plain:"",type:"info",size:"mini"}},[e._v("迁移")]),"No"===a.row.metadata.annotations.status?t("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(t){return e.startPod(a.$index,a.row)}}},[e._v("启动")]):t("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.stopPod(a.$index,a.row)}}},[e._v("停止")]),t("el-button",{attrs:{plain:"",size:"mini",type:"danger"},on:{click:function(t){return e.deletePod(a.$index,a.row)}}},[e._v("删除")])],1)]}}])},[t("template",{slot:"header"},[t("el-input",{attrs:{size:"mini",placeholder:"输入名称搜索"},model:{value:e.psearch,callback:function(t){e.psearch=t},expression:"psearch"}})],1)],2)],1),0!=e.poddata.length?t("div",{staticStyle:{"margin-top":"30px"}},[t("el-pagination",{attrs:{"current-page":e.pod_curpage,"page-sizes":[10,20,30,40,50],"page-size":e.pod_pagesize,layout:"sizes, total, prev, pager, next, jumper",total:e.totalpod,background:""},on:{"update:currentPage":function(t){e.pod_curpage=t},"update:current-page":function(t){e.pod_curpage=t},"update:pageSize":function(t){e.pod_pagesize=t},"update:page-size":function(t){e.pod_pagesize=t}}})],1):e._e(),t("el-dialog",{attrs:{title:"添加Pod",visible:e.createpodvisible},on:{"update:visible":function(t){e.createpodvisible=t}}},[t("el-form",{ref:"cp_form",attrs:{"label-position":"top","label-width":"80px",model:e.cp_form,"status-icon":!0,rules:e.cp_rules}},[t("el-form-item",{attrs:{label:"Pod名称",prop:"podName"}},[t("el-input",{attrs:{placeholder:"请输入Pod名称"},model:{value:e.cp_form.podName,callback:function(t){e.$set(e.cp_form,"podName",t)},expression:"cp_form.podName"}})],1),t("el-form-item",{attrs:{label:"命名空间",prop:"namespace"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择命名空间"},on:{"visible-change":e.nsremote},model:{value:e.cp_form.namespace,callback:function(t){e.$set(e.cp_form,"namespace",t)},expression:"cp_form.namespace"}},e._l(e.namespace_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"选择节点",prop:"nodename"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择节点"},on:{"visible-change":e.noderemote},model:{value:e.cp_form.nodename,callback:function(t){e.$set(e.cp_form,"nodename",t)},expression:"cp_form.nodename"}},e._l(e.nodename_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"选择持久卷声明",prop:"pvcName"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择pvc"},on:{"visible-change":e.pvcremote},model:{value:e.cp_form.pvcName,callback:function(t){e.$set(e.cp_form,"pvcName",t)},expression:"cp_form.pvcName"}},e._l(e.pvcName_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"所属容器",prop:"containerInfoList"}},[e._l(e.cp_form.containerInfoList,(function(a){return t("el-popover",{key:a.containerName,staticStyle:{"margin-right":"10px"},attrs:{placement:"top-start",title:a.containerName,width:"200",trigger:"hover"}},[t("el-descriptions",{attrs:{column:1,size:"mini"}},[t("el-descriptions-item",{attrs:{label:"镜像"}},[e._v(e._s(a.containerImage))]),t("el-descriptions-item",{attrs:{label:"端口号"}},[e._v(e._s(a.port))])],1),t("el-tag",{attrs:{slot:"reference",closable:"","disable-transitions":!1,type:"info",effect:"plain"},on:{close:function(t){return e.handleClose(a)}},slot:"reference"},[e._v(" "+e._s(a.containerName)+" ")])],1)})),e.addvisible?t("el-card",{staticClass:"con-card",attrs:{shadow:"hover"}},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12,offset:0}},[t("span",[e._v("添加第 "+e._s(e.cp_form.containerInfoList.length+1)+" 个新容器")])]),t("el-col",{attrs:{span:3,offset:3}},[t("el-button",{attrs:{icon:"el-icon-check",size:"mini",circle:"",plain:"",type:"success"},on:{click:function(t){return e.addcontainer("tmp_con_info")}}})],1),t("el-col",{attrs:{span:3,offset:0}},[t("el-button",{attrs:{icon:"el-icon-refresh-right",size:"mini",circle:""},on:{click:function(t){return e.resetForm("tmp_con_info")}}})],1),t("el-col",{attrs:{span:3,offset:0}},[t("el-button",{attrs:{icon:"el-icon-close",size:"mini",circle:"",plain:"",type:"danger"},on:{click:e.closeadd}})],1)],1)],1),t("el-form",{ref:"tmp_con_info",attrs:{"label-position":"top",model:e.tmp_con_info,"status-icon":!0,rules:e.tmp_con_rules}},[t("el-form-item",{attrs:{label:"容器名称",prop:"containerName"}},[t("el-input",{attrs:{placeholder:"请输入容器名称",clearable:""},model:{value:e.tmp_con_info.containerName,callback:function(t){e.$set(e.tmp_con_info,"containerName",t)},expression:"tmp_con_info.containerName"}})],1),t("el-form-item",{attrs:{label:"容器镜像",prop:"containerImage"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择容器镜像"},on:{"visible-change":e.imageremote},model:{value:e.tmp_con_info.containerImage,callback:function(t){e.$set(e.tmp_con_info,"containerImage",t)},expression:"tmp_con_info.containerImage"}},e._l(e.containerImage_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"端口号",prop:"port"}},[t("el-input",{attrs:{placeholder:"请输入端口号"},model:{value:e.tmp_con_info.port,callback:function(t){e.$set(e.tmp_con_info,"port",t)},expression:"tmp_con_info.port"}})],1)],1)],1):t("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showInputCon}},[e._v("添加容器")])],2),t("el-form-item",{attrs:{size:"large"}},[t("div",{staticClass:"cp-sbm-area"},[t("el-button",{attrs:{round:""},on:{click:function(t){return e.resetForm("cp_form")}}},[e._v("清空输入")]),t("el-button",{attrs:{round:"",type:"primary"},on:{click:function(t){return e.cp_sumbit("cp_form")}}},[e._v("立即创建")])],1)])],1)],1)],1)])},o=[],r=(a(70560),{name:"ResPool",mounted(){this.resloading=!0,this.beginTime=+new Date,this.getnodeinfo(),this.getPodList()},data(){var e=(e,t,a)=>{if(console.log(t),t.length<1)return a(new Error("请添加至少一个容器"));a()};return{beginTime:0,endTime:0,createpodvisible:!1,cp_form:{podName:"",namespace:"",nodename:"",pvcName:"",containerInfoList:[]},migrate_form:{nodename:""},cp_rules:{podName:[{required:!0,message:"请输入Pod名称",trigger:"blur"}],namespace:[{required:!0,message:"请选择命名空间",trigger:"change"}],nodename:[{required:!0,message:"请选择节点",trigger:"change"}],pvcName:[{required:!0,message:"请输入Pvc名称",trigger:"change"}],containerInfoList:[{validator:e,trigger:"change"}]},migrate_rules:{nodename:[{required:!0,message:"请选择迁移的节点名称",trigger:"change"}]},tmp_con_info:{containerName:"",containerImage:"",port:"80"},tmp_con_rules:{containerName:[{required:!0,message:"请输入容器名称",trigger:"blur"}],containerImage:[{required:!0,message:"请选择容器镜像",trigger:"change"}],port:[{required:!0,message:"请输入端口号",trigger:"blur"}]},namespace_options:[],containerImage_options:[{value:"",label:""}],nodename_options:[],pvcName_options:[],addvisible:!1,poddrawer:!1,imagedrawer:!1,res_state:"",baseurl:"http://39.98.124.97:8080",execurl:"http://"+this.$store.state.nodeip+":8081",vmdata:[],psearch:"",pod_psearch:"",serverip:"",images:[],curpage:1,pod_curpage:1,totalvm:0,totalpod:0,pagesize:10,pod_pagesize:10,formInline:{},buildvmvisible:!1,commandvisible:!1,command_tmp_data:{name:"无",state:"无",cpuNum:"无",ipaddr:"无",maxMem:"无"},nettype_options:[{label:"bridge",value:"bridge"},{label:"nat",value:"nat"}],node_options:[{label:"云节点:39.98.124.97",value:"192.168.194.178"},{label:"端节点1:192.168.194.45",value:"192.168.194.45"},{label:"端节点2:192.168.194.164",value:"192.168.194.164"}],ostype_options:[{label:"x86",value:"X86"},{label:"arm",value:"arm"}],cpunum_options:[{label:"1 个",value:"1"},{label:"2 个",value:"2"},{label:"4 个",value:"4"},{label:"6 个",value:"6"},{label:"8 个",value:"8"},{label:"10 个",value:"10"}],memory_options:[{label:"1 GiB",value:"1"},{label:"2 GiB",value:"2"},{label:"4 GiB",value:"4"},{label:"6 GiB",value:"6"},{label:"8 GiB",value:"8"},{label:"16 GiB",value:"16"},{label:"24 GiB",value:"24"},{label:"32 GiB",value:"32"}],edgeserver_options:[{label:"端1",value:"worker1"}],pod_options:[{label:"容器1",value:"pod1"}],formData:{name:"",memory:"",cpuNum:"",OStype:"",node:"",nettype:""},commandForm:{command:"",edgeserver:"",pod:"",res_state:"",result:""},vm_rules:{name:[{required:!0,message:"请输入虚拟机名称",trigger:"blur"}],memory:[{required:!0,message:"请选择内存大小",trigger:"change"}],node:[{required:!0,message:"请选择创建虚拟机所在的节点",trigger:"change"}],nettype:[{required:!0,message:"请选择创建虚拟机的网络类型",trigger:"change"}],cpuNum:[{required:!0,message:"请选择CPU个数",trigger:"change"}],OStype:[{required:!0,message:"请选择系统类型",trigger:"change"}]},command_rules:{command:[{required:!0,message:"请输入命令",trigger:"blur"}]},vmpod_tmp_data:{},vmimg_tmp_data:{},cidata:[],pcisearch:"",iamgename:"",img_list:[],fullloading:!1,poddata:[],ppodsearch:"",nodeinfo:[],temparr1:0,temparr2:0,temparr3:0,resloading:!1}},methods:{formatDate(e,t){const a=new Date(e),s=a.getFullYear(),o=String(a.getMonth()+1).padStart(2,"0"),r=String(a.getDate()).padStart(2,"0"),i=String(a.getHours()).padStart(2,"0"),l=String(a.getMinutes()).padStart(2,"0"),n=String(a.getSeconds()).padStart(2,"0");return"YYYY-MM-DD"===t?`${s}-${o}-${r}`:"HH:mm:ss"===t?`${i}:${l}:${n}`:""},showInputCon(){this.addvisible=!0},closeadd(){this.addvisible=!1},addcontainer(e){this.$refs[e].validate((e=>{if(!e)return console.log("表单验证不通过"),!1;this.cp_form.containerInfoList.push(JSON.parse(JSON.stringify(this.tmp_con_info))),this.addvisible=!1}))},handleClose(e){this.cp_form.containerInfoList.splice(this.cp_form.containerInfoList.indexOf(e),1)},openCreatePod(){this.createpodvisible=!0},getPodList(){this.$axios.get(this.baseurl+"/workload/getPodList").then((e=>{this.poddata=JSON.parse(e.data.result).items;for(let t=0;t<this.poddata.length;t++)this.poddata[t].info={},this.poddata[t].spec.volumes?(this.poddata[t].info.ppname=this.poddata[t].spec.volumes[0].name,this.$axios.get(this.baseurl+"/virtuleStorage/pvPath?pvName="+this.poddata[t].spec.volumes[0].name).then((e=>{this.poddata[t].info.podpath=e.data.pvPath})).catch((e=>{console.log(this.poddata[t].spec.volumes[0].name+"无path")})),this.poddata[t].info.podpath||(this.poddata[t].info.podpath="---")):(this.poddata[t].info.ppname="---",this.poddata[t].info.podpath="---");this.totalpod=this.poddata.length,this.temparr2=1})).catch((e=>{console.log("errors",e)}))},startPod(e,t){this.$axios({method:"post",url:this.baseurl+"/workload/startPod",data:{podName:t.metadata.name,podNamespace:t.metadata.namespace,podNodeName:t.spec.nodename,containerInfoList:[]},headers:{"Content-Type":"application/json"}}).then((e=>{console.log(e),this.$notify.success({title:"操作通知",message:"容器 "+t.metadata.name+" 启动成功",position:"bottom-right"}),t.metadata.annotations.status="Yes"}),(e=>{console.log(e),this.$notify.error({title:"操作失败",message:"请检查网络连接设置",position:"bottom-right"})}))},stopPod(e,t){this.$axios({method:"post",url:this.baseurl+"/workload/stopPod",data:{podName:t.metadata.name,podNamespace:t.metadata.namespace,podNodeName:t.spec.nodename,containerInfoList:[]},headers:{"Content-Type":"application/json"}}).then((e=>{console.log(e),this.$notify.success({title:"操作通知",message:"容器 "+t.metadata.name+" 停止成功",position:"bottom-right"}),t.metadata.annotations.status="No"}),(e=>{console.log(e),this.$notify.error({title:"操作失败",message:"请检查网络连接设置",position:"bottom-right"})}))},cp_sumbit(e){this.$refs[e].validate((e=>{if(!e)return console.log("表单验证不通过"),!1;{const e={podName:this.cp_form.podName,podNamespace:this.cp_form.namespace,podNodeName:this.cp_form.nodename,containerInfoList:this.cp_form.containerInfoList},t={pvcName:this.cp_form.pvcName};this.$axios({method:"post",url:this.baseurl+"/workload/createPod",data:{podInfo:e,pvcInfo:t},headers:{"Content-Type":"application/json"}}).then((e=>{console.log(e),"E"===e.data[0]?this.$notify.error({title:"创建失败",message:e.data,position:"bottom-right"}):(this.$notify.success({title:"完成通知",message:"容器 "+this.cp_form.podName+" 创建成功",position:"bottom-right"}),this.getPodList())}),(e=>{console.log(e),this.$notify.error({title:"创建失败",message:"请检查网络连接设置",position:"bottom-right"})})),this.createpodvisible=!1}}))},deletePod(e,t){this.$axios({method:"post",url:this.baseurl+"/workload/deletePod",data:{podName:t.metadata.name,podNamespace:t.metadata.namespace,podNodeName:t.spec.nodename,containerInfoList:[]},headers:{"Content-Type":"application/json"}}).then((e=>{this.$notify.success({title:"操作通知",message:"容器 "+t.metadata.name+"删除成功",position:"bottom-right"}),this.getPodList()}),(e=>{console.log(e),this.$notify.error({title:"删除失败",message:"请检查网络连接设置",position:"bottom-right"})}))},migrate_sumbit(e,t,a){console.log(a),this.$refs[a].validate((e=>{if(console.log(t.metadata.name),console.log(this.migrate_form.nodename),!e)return console.log("表单验证不通过"),!1;this.$axios({method:"post",url:this.baseurl+"/workload/editPod",data:{podName:t.metadata.name,podNamespace:t.metadata.namespace,podNodeName:this.migrate_form.nodename},headers:{"Content-Type":"application/json"}}).then((e=>{"E"===e.data[0]?this.$notify.error({title:"迁移失败",message:e.data,position:"bottom-right"}):this.$notify.success({title:"操作通知",message:"容器 "+t.metadata.name+"迁移成功",position:"bottom-right"}),this.getPodList()}),(e=>{console.log(e),this.$notify.error({title:"迁移失败",message:"请检查网络连接设置",position:"bottom-right"})}))}))},resetForm(e){this.$refs[e].resetFields()},nsremote(){this.$axios.get(this.baseurl+"/workload/namespace/list").then((e=>{console.log(JSON.parse(e.data.result));let t=JSON.parse(e.data.result).items,a=[];for(let s=0;s<t.length;s++){let e={};e["label"]=t[s].metadata.name,e["value"]=t[s].metadata.name,a.push(e)}this.namespace_options=a})).catch((e=>{console.log("errors",e)}))},noderemote(){this.$axios.get(this.baseurl+"/workload/node/list").then((e=>{console.log(JSON.parse(e.data.result));let t=JSON.parse(e.data.result).items,a=[];for(let s=0;s<t.length;s++){let e={};e["label"]=t[s].metadata.name,e["value"]=t[s].metadata.name,a.push(e)}this.nodename_options=a})).catch((e=>{console.log("errors",e)}))},pvcremote(){this.$axios.get(this.baseurl+"/virtuleStorage/vs/pvclist").then((e=>{console.log(e),console.log(JSON.parse(e.data.result));let t=JSON.parse(e.data.result).items,a=[];for(let s=0;s<t.length;s++){let e={};e["label"]=t[s].metadata.name,e["value"]=t[s].metadata.name,a.push(e)}this.pvcName_options=a})).catch((e=>{console.log("errors",e)}))},imageremote(){this.$axios.post(this.baseurl+"/containerd/images/list",{virtualMachineIp:"39.98.124.97",userName:"root",userPassword:"Upc123456@"}).then((e=>{let t=this.data_resolver(e.data.result);console.log(t);let a=[];for(let s=0;s<t.length;s++){let e={};e["label"]=t[s].imageName+":"+t[s].imageTag,e["value"]=t[s].imageName+":"+t[s].imageTag,a.push(e)}this.containerImage_options=a})).catch((e=>{console.log("errors",e)}))},data_resolver(e){let t=[],a=e.split("\n"),s=1;for(;s<a.length-1;s++){let e=a[s].split(" ");e=e.filter((function(e){return""!==e})),t.push({imageName:e[0],imageTag:e[1],imageId:e[2],imageSize:e[3]})}return t},getnodeinfo(){this.$axios.get(this.baseurl+"/node/getNodeList1").then((e=>{this.temparr1=1,this.nodeinfo=e.data.content,this.vmdata=[];for(let t=0;t<this.nodeinfo.length;t++)this.getVMList("http://"+this.nodeinfo[t].nodeIp+":8080")})).catch((e=>{console.log("errors",e)}))},deletepod(e,t){this.$axios.delete(this.baseurl+"/docker/deleteContainer?vmName="+this.vmpod_tmp_data.name+"&endIp="+this.$store.state.nodeip+"&containerId="+t.conid).then((e=>{0==e.data.exitStatus?(this.$message({message:"容器"+t.conid+"删除成功",type:"success"}),this.get_vm_pod()):this.$message({message:e.data.errorOutput,type:"error"})})).catch((e=>{console.log("errors",e),this.$message({message:"删除失败，请检查网络设置",type:"error"})}))},stoppod(e,t){this.$axios.post(this.baseurl+"/docker/stopContainer?vmName="+this.vmpod_tmp_data.name+"&endIp="+this.$store.state.nodeip+"&containerId="+t.conid).then((e=>{0==e.data.exitStatus?(this.$message({message:"容器"+t.conid+"停止成功",type:"success"}),this.get_vm_pod()):this.$message({message:e.data.errorOutput,type:"error"})})).catch((e=>{console.log("errors",e),this.$message({message:"停止失败，请检查网络设置",type:"error"})}))},startpod(e,t){this.$axios.post(this.baseurl+"/docker/startContainer?vmName="+this.vmpod_tmp_data.name+"&endIp="+this.$store.state.nodeip+"&containerId="+t.conid).then((e=>{0==e.data.exitStatus?(this.$message({message:"容器"+t.conid+"启动成功",type:"success"}),this.get_vm_pod()):this.$message({message:e.data.errorOutput,type:"error"})})).catch((e=>{console.log("errors",e),this.$message({message:"启动失败，请检查网络设置",type:"error"})}))},deleteimage(e,t){this.$axios.delete(this.baseurl+"/docker/deleteImage?vmName="+this.vmimg_tmp_data.name+"&endIp="+this.$store.state.nodeip+"&imageName="+t.repository+":"+t.tag).then((e=>{0==e.data.exitStatus?(this.$message({message:"镜像"+t.repository+"删除成功",type:"success"}),this.get_vm_img()):this.$message({message:e.data.errorOutput,type:"error"})})).catch((e=>{console.log("errors",e),this.$message({message:"删除失败，请检查网络设置",type:"error"})}))},startimage(e,t){this.$prompt("请输入启动命令","启动提示",{confirmButtonText:"启动",cancelButtonText:"取消",inputPlaceholder:"请输入启动命令",inputValue:"docker run -d "+t.repository+":"+t.tag}).then((({value:e})=>{this.$axios.post(this.baseurl+"/docker/run?vmName="+this.vmimg_tmp_data.name+"&endIp="+this.$store.state.nodeip+"&command="+e).then((e=>{0==e.data.exitStatus?(this.$message({message:"镜像"+t.repository+"启动成功",type:"success"}),this.get_vm_img()):this.$message({message:e.data.errorOutput,type:"error"})})).catch((e=>{console.log("errors",e),this.$message({message:"启动失败，请检查网络设置",type:"error"})}))}))},uploadImgToVm(){""===this.iamgename?this.$message({message:"请先选择要上传的镜像",type:"error"}):(this.fullloading=!0,this.$axios.post(this.baseurl+"/docker/mkdir?vmName="+this.vmimg_tmp_data.name+"&endIp="+this.$store.state.nodeip+"&targetPath=/testimg").then((e=>{0==e.data.exitStatus?this.$axios.post(this.baseurl+"/docker/upload?vmName="+this.vmimg_tmp_data.name+"&endIp="+this.$store.state.nodeip+"&fileName="+this.iamgename+"&targetPath=/testimg&sourceIp=39.98.124.97").then((e=>{0==e.data.exitStatus?(this.$message({message:"上传成功，等待导入到Docker",type:"success"}),this.$axios.post(this.baseurl+"/docker/import?vmName="+this.vmimg_tmp_data.name+"&endIp="+this.$store.state.nodeip+"&targetPath=/testimg/&imageFileName="+this.iamgename).then((e=>{0==e.data.exitStatus?(this.$message({message:"导入镜像"+this.iamgename+"成功",type:"success"}),this.fullloading=!1,this.get_vm_img()):"Command execution timed out or the file is still uploading."!=e.data.errorOutput?this.$message({message:e.data.errorOutput,type:"error"}):(this.$message({message:"镜像"+this.iamgename+"导入进行中，请稍后查看",type:"success"}),this.fullloading=!1,this.get_vm_img())})).catch((e=>{console.log("errors",e),this.$message({message:"导入失败，请检查网络设置",type:"error"})}))):this.$message({message:e.data.errorOutput,type:"error"})})).catch((e=>{console.log("errors",e),this.$message({message:"上传失败，请检查网络设置",type:"error"})})):this.$message({message:"创建文件夹失败，请检查虚拟机目录",type:"error"})})).catch((e=>{console.log("errors",e),this.$message({message:"创建文件夹失败，请检查网络问题",type:"error"})})))},getimg(){this.img_list=[],this.$axios.get("http://39.98.124.97:8081/api/ssh/imgListByIP?ip=39.98.124.97").then((e=>{let t=e.data.output.split("\n");t.pop();for(let a=0;a<t.length;a++)this.img_list.push({label:t[a],value:t[a]})})).catch((e=>{console.log("errors",e)}))},imgdopen(){this.cidata=[],this.iamgename="",this.img_list=[],this.get_vm_img()},podopen(){this.poddata=[],this.get_vm_pod()},get_vm_pod(){this.$axios.get(this.baseurl+"/docker/containerList?vmName="+this.vmpod_tmp_data.name+"&endIp="+this.$store.state.nodeip).then((e=>{this.poddata=this.data_resolver_pod(JSON.parse(e.data[0]).output)})).catch((e=>{console.log("errors",e)}))},get_vm_img(){this.$axios.get(this.baseurl+"/docker/imageList?vmName="+this.vmimg_tmp_data.name+"&endIp="+this.$store.state.nodeip).then((e=>{this.cidata=this.data_resolver_image(JSON.parse(e.data[0]).output)})).catch((e=>{console.log("errors",e)}))},data_resolver_pod(e){let t=[],a=e.split("\n"),s=1;for(;s<a.length-1;s++){let e=a[s].split("   ");e=e.filter((function(e){return""!==e})),t.push({conid:e[0],image:e[1],command:e[2],created:e[3],status:e[4],ports:"",names:e[5]})}return t},data_resolver_image(e){let t=[],a=e.split("\n"),s=1;for(;s<a.length-1;s++){let e=a[s].split("   ");e=e.filter((function(e){return""!==e})),t.push({repository:e[0],tag:e[1],imageid:e[2],created:e[3],size:e[4]})}return t},openpod(e){this.poddrawer=!0,this.vmpod_tmp_data=e},openimage(e){this.imagedrawer=!0,this.vmimg_tmp_data=e},start_command(e){this.$refs[e].validate((e=>{if(!e)return console.log("表单验证不通过"),!1;this.$axios({method:"post",url:this.execurl+"/api/ssh/execute",data:{VMname:this.command_tmp_data.name,commands:this.commandForm.command.split("\n")},headers:{"Content-Type":"application/json"}}).then((e=>{console.log(e),0===e.data.exitStatus?(this.commandForm.res_state="yes",this.commandForm.result=e.data.output):(this.commandForm.res_state="no",this.commandForm.result=e.data.errorOutput)}),(e=>{console.log(e),this.commandForm.result="网络错误，请检查网络",this.commandForm.res_state="no"}))}))},suzhuchange(e){this.serverip=e,this.baseurl="http://"+this.serverip+":8080",this.execurl="http://"+this.serverip+":8081",this.getVMList()},opencommand(e){this.commandvisible=!0,this.command_tmp_data=e},getVMList(e){this.$axios.get(e+"/getVMList").then((e=>{this.vmdata=this.vmdata.concat(e.data),this.totalvm=this.vmdata.length,this.temparr3=1})).catch((e=>{console.log("errors",e)}))},openCreateVM(){this.buildvmvisible=!0},refreshIP(){for(let e=0;e<this.nodeinfo.length;e++)this.$axios.get(this.baseurl+"/VMInfo/updateip/"+this.nodeinfo[e].nodeIp).then((e=>{const t=e.data;t.success?(this.$message.success("更新成功！"),this.getnodeinfo()):this.$message.success("更新失败！")}))},validName(){this.formData.name.includes(".")&&this.$notify.error({message:"虚拟机名字不能包括特殊字符"})},nsremote(){this.$axios.get(this.baseurl+"/Images/imgList").then((e=>{let t=[];for(let a=0;a<e.data.content.length;a++){let s={};s["label"]=e.data.content[a].name,s["value"]=e.data.content[a].name,t.push(s)}this.images=t})).catch((e=>{console.log("errors",e)}))},vmc_sumbit(e){this.$refs[e].validate((e=>{if(!e)return console.log("表单验证不通过"),!1;this.buildvmvisible=!1,this.$axios.get(this.baseurl+"/addVirtual?ImgName="+this.formData.ImgName+"&name="+this.formData.name+"&memory="+this.formData.memory+"&cpuNum="+this.formData.cpuNum+"&OStype="+this.formData.OStype+"&nettype="+this.formData.nettype+"&serverip="+this.formData.node).then((e=>{!1===e.data.success?this.$notify.error({title:"创建虚拟机失败",message:e.data.msg,position:"bottom-right"}):this.$notify.success({title:"创建虚拟机成功",message:"创建虚拟机"+this.formData.name+"成功",position:"bottom-right"}),this.getnodeinfo()})).catch((e=>{this.$notify.error({title:"创建失败",message:e,position:"bottom-right",duration:6e3})}))}))},resetForm(e){this.$refs[e].resetFields()},vmstart(e){this.$axios.get(this.baseurl+"/initiate/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("启动成功！"),this.getnodeinfo()):this.$message.success("启动失败！")}))},vmsuspend(e){this.$axios.get(this.baseurl+"/suspended/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("挂起成功！"),this.getnodeinfo()):this.$message.success("挂起失败！")}))},vmresume(e){this.$axios.get(this.baseurl+"/resume/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("还原成功！"),this.getnodeinfo()):this.$message.success("还原失败！")}))},vmreboot(e){this.$axios.get(this.baseurl+"/reboot/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("重启中..."),this.getnodeinfo()):this.$message.success("重启失败！")}))},vmshutdown(e){this.$axios.get(this.baseurl+"/shutdown/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("关机成功！"),this.getnodeinfo()):this.$message.success("关机失败！")}))},vmshutdownMust(e){this.$confirm("您确定强行关机吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$axios.get(this.baseurl+"/shutdownMust/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("强行关机成功！"),this.getnodeinfo()):this.$message.success("强行关机失败！")}))})).catch((()=>{this.$message({type:"info",message:"已取消"})}))},vmdelete(e){this.$confirm("您确定删除该虚拟机吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$axios.delete(this.baseurl+"/delete/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("删除成功！"),this.getnodeinfo()):this.$message.success("删除失败！")}))})).catch((()=>{this.$message({type:"info",message:"已取消"})}))}},watch:{temparr1(e,t){1==this.temparr1&&1==this.temparr2&&1==this.temparr3&&(this.endTime=+new Date,this.resloading=!1)},temparr2(e,t){1==this.temparr1&&1==this.temparr2&&1==this.temparr3&&(this.endTime=+new Date,this.resloading=!1)},temparr3(e,t){1==this.temparr1&&1==this.temparr2&&1==this.temparr3&&(this.endTime=+new Date,this.resloading=!1)}}}),i=r,l=a(1001),n=(0,l.Z)(i,s,o,!1,null,null,null),m=n.exports}}]);
//# sourceMappingURL=574.06a22435.js.map