"use strict";(self["webpackChunkkfront"]=self["webpackChunkkfront"]||[]).push([[20],{91020:function(e,t,a){a.r(t),a.d(t,{default:function(){return p}});var r=function(){var e=this,t=e._self._c;return t("div",[t("div",[t("div",{staticStyle:{padding:"10px"}},[t("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.addResourceType}},[e._v("新增资源类型")]),t("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.addResourceDataType}},[e._v("新增数据类型")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{data:e.resourceTypeData}},[t("el-table-column",{attrs:{prop:"id",label:"资源类型ID",width:"180"}}),t("el-table-column",{attrs:{prop:"name",label:"资源类型名称"}}),t("el-table-column",{attrs:{prop:"description",label:"资源类型描述"}}),t("el-table-column",{attrs:{prop:"attributes",label:"关联的资源属性"},scopedSlots:e._u([{key:"default",fn:function(a){return e._l(a.row.attributes,(function(a,r){return t("span",[e._v(e._s(r)+"："+e._s(a.info)+" "),t("br")])}))}}])}),t("el-table-column",{attrs:{prop:"action",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-popconfirm",{attrs:{title:"是否确认删除该资源类型？确认后会删除资源类型关联下的所有资源"},on:{confirm:()=>e.confirmDelete(a.row)}},[t("el-button",{attrs:{slot:"reference",type:"danger",plain:""},slot:"reference"},[e._v("删除")])],1),t("el-divider",{attrs:{direction:"vertical"}}),t("el-button",{attrs:{type:"primary",plain:""},on:{click:()=>e.gotoResource(a.row)}},[e._v("查看绑定的资源")])]}}])})],1),t("el-drawer",{attrs:{visible:e.open,title:"新增资源类型",size:"40%","show-close":!1},on:{"update:visible":function(t){e.open=t}}},[t("div",{staticStyle:{position:"absolute",top:"10px",right:"10px"}},[t("el-button",{staticStyle:{"margin-right":"8px"},on:{click:e.onClose}},[e._v("取消")]),t("el-button",{attrs:{loading:e.submitLoading,type:"primary"},on:{click:e.submit}},[e._v("提交")])],1),t("el-form",{ref:"dynamicValidateForm",staticStyle:{padding:"10px"},attrs:{model:e.dynamicValidateForm,"label-width":"120px"}},[t("el-form-item",{attrs:{rules:{required:!0,message:"缺少资源类型名称"},label:"资源类型名称",prop:"name"}},[t("el-input",{model:{value:e.dynamicValidateForm.name,callback:function(t){e.$set(e.dynamicValidateForm,"name",t)},expression:"dynamicValidateForm.name"}})],1),t("el-form-item",{attrs:{rules:{required:!0,message:"缺少资源类型描述"},label:"资源类型描述",prop:"description"}},[t("el-input",{model:{value:e.dynamicValidateForm.description,callback:function(t){e.$set(e.dynamicValidateForm,"description",t)},expression:"dynamicValidateForm.description"}})],1),e._l(e.dynamicValidateForm.attributes,(function(a,r){return t("div",{key:a.id,staticStyle:{display:"flex","margin-bottom":"8px"}},[t("el-form-item",{attrs:{"label-width":"12px",prop:["attributes",r,"info"].join("."),rules:{required:!0,message:"缺少资源属性中文名称"}}},[t("el-input",{attrs:{placeholder:"资源属性中文名称"},model:{value:a.info,callback:function(t){e.$set(a,"info",t)},expression:"attribute.info"}})],1),t("el-form-item",{attrs:{"label-width":"12px",prop:["attributes",r,"name"].join("."),rules:{required:!0,validator:e.checkEnglishName}}},[t("el-input",{attrs:{placeholder:"资源属性英文名称"},model:{value:a.name,callback:function(t){e.$set(a,"name",t)},expression:"attribute.name"}})],1),t("el-form-item",{attrs:{"label-width":"12px",prop:["attributes",r,"data_type"].join("."),rules:{required:!0,message:"缺少资源属性类型"}}},[t("el-select",{staticStyle:{"min-width":"120px"},attrs:{placeholder:"资源属性类型"},model:{value:a.data_type,callback:function(t){e.$set(a,"data_type",t)},expression:"attribute.data_type"}},e._l(e.resourceTypeOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-button",{staticStyle:{height:"40px","margin-left":"12px"},attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.removeAttribute(a)}}})],1)})),t("el-button",{staticStyle:{width:"100%"},attrs:{icon:"el-icon-plus"},on:{click:e.addAttribute}},[e._v(" 新增资源类型属性 ")])],2)],1),t("el-drawer",{attrs:{visible:e.dataTypeOpen,title:"新增数据类型",size:"40%","show-close":!1},on:{"update:visible":function(t){e.dataTypeOpen=t}}},[t("div",{staticStyle:{position:"absolute",top:"10px",right:"10px"}},[t("el-button",{staticStyle:{"margin-right":"8px"},on:{click:e.onDataTypeClose}},[e._v("取消")]),t("el-button",{attrs:{loading:e.dataTypeLoading,type:"primary"},on:{click:e.submitAddDataType}},[e._v("新增")])],1),t("el-form",{ref:"dataTypeForm",staticStyle:{padding:"10px"},attrs:{model:e.dataTypeForm,"label-width":"120px"}},[t("el-form-item",{attrs:{rules:{required:!0,message:"缺少数据类型中文名"},label:"数据类型中文名",prop:"info"}},[t("el-input",{model:{value:e.dataTypeForm.info,callback:function(t){e.$set(e.dataTypeForm,"info",t)},expression:"dataTypeForm.info"}})],1),t("el-form-item",{attrs:{rules:{required:!0,message:"缺少数据类型英文名"},label:"数据类型英文名",prop:"name"}},[t("el-input",{attrs:{placeholder:"现在仅支持string, int, float, boolean"},model:{value:e.dataTypeForm.name,callback:function(t){e.$set(e.dataTypeForm,"name",t)},expression:"dataTypeForm.name"}})],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableDataLoading,expression:"tableDataLoading"}],attrs:{data:e.resourceDataTypeData}},[t("el-table-column",{attrs:{prop:"info",label:"数据类型中文名"}}),t("el-table-column",{attrs:{prop:"name",label:"数据类型英文名"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-popconfirm",{attrs:{title:"是否确认删除该数据类型？"},on:{confirm:()=>e.confirmDeleteDataType(a.row)}},[t("el-button",{attrs:{slot:"reference",type:"danger",plain:""},slot:"reference"},[e._v("删除")])],1)]}}])})],1)],1)],1)])},i=[],n=(a(70560),a(60773)),s=a(59684),o=a(42325),l={name:"ResourceTypeManage",data(){return{resourceTypeColumns:n.rD,open:!1,resourceTypeData:[],resourceDataTypeData:[],tableLoading:!1,tableDataLoading:!1,submitLoading:!1,dataTypeLoading:!1,dataTypeOpen:!1,dataTypeForm:{name:"",info:""},dynamicValidateForm:{name:"",description:"",attributes:[]}}},computed:{resourceTypeOptions(){return this.resourceDataTypeData.map((e=>({label:e.info,value:e.id})))}},watch:{open(e){e&&(this.$refs.dynamicValidateForm?.resetFields(),this.dynamicValidateForm.attributes=[])},dataTypeOpen(e){e&&(this.$refs.dataTypeForm?.resetFields(),this.dataTypeForm.info="",this.dataTypeForm.name="")}},methods:{addResourceType(){this.open=!0,this.getResourceDataType()},addResourceDataType(){this.dataTypeOpen=!0,this.getResourceDataType()},async getResourceDataType(){const e=await(0,s.b3)().catch((e=>e));if(!(0,o.d)(e))return this.$message.error(e.message||"请求失败");this.resourceDataTypeData=e.data},async getResourceTypeData(){this.tableLoading=!0;const e=await(0,s.XQ)().catch((e=>e));if(this.tableLoading=!1,!(0,o.d)(e))return this.$message.error(e.message||"请求失败");const t=e.data.map((e=>{const{id:t,name:a,description:r}=e.resource_type;return{...e,id:t,name:a,description:r}}));this.resourceTypeData=t},onClose(){this.open=!1},onDataTypeClose(){this.dataTypeOpen=!1},async submit(){this.submitLoading=!0,this.$refs.dynamicValidateForm.validate((async e=>{if(!e)return this.submitLoading=!1;const{attributes:t,info:a,name:r,description:i}=this.dynamicValidateForm,n={resource_type:{name:r,info:a,description:i},attributes:t},l=await(0,s.Jo)(n).catch((e=>e));if(!(0,o.d)(l))return this.submitLoading=!1,this.$message.error(l.message||"请求失败");this.submitLoading=!1,this.open=!1,this.$message.success("新增成功"),this.getResourceTypeData()}))},addAttribute(){this.dynamicValidateForm.attributes.push({name:"",data_type:void 0,info:""})},checkEnglishName(e,t,a){const r=/^[a-zA-Z0-9_]+$/;return t?r.test(t)?a():a(new Error("只能是英文数字和下划线")):a(new Error("资源属性英文名称不能为空"))},removeAttribute(e){const t=this.dynamicValidateForm.attributes.indexOf(e);-1!==t&&this.dynamicValidateForm.attributes.splice(t,1)},async confirmDelete({resource_type:e}){const t=await(0,s.fC)(e.id).catch((e=>e));if(!(0,o.d)(t))return this.$message.error(t.message||"请求失败");this.$message.success("删除成功"),this.getResourceTypeData()},async submitAddDataType(){this.dataTypeLoading=!0,this.$refs.dataTypeForm.validate((async e=>{if(!e)return this.dataTypeLoading=!1;const{name:t,info:a}=this.dataTypeForm,r={name:t,info:a},i=await(0,s.OE)(r).catch((e=>e));if(!(0,o.d)(i))return this.dataTypeLoading=!1,this.$message.error(i.message||"请求失败");this.dataTypeLoading=!1,this.$message.success("新增成功"),this.dataTypeForm.name="",this.dataTypeForm.info="",this.$refs.dataTypeForm.resetFields(),this.getResourceDataType()}))},async confirmDeleteDataType({id:e}){const t=await(0,s.p2)(e).catch((e=>e));if(!(0,o.d)(t))return this.$message.error(t.message||"请求失败");this.$message.success("删除成功"),this.getResourceDataType()},gotoResource({resource_type:e}){this.$router.push({name:"resourceManage",query:{resource_type_id:e.id}})}},mounted(){this.getResourceTypeData()}},c=l,d=a(1001),u=(0,d.Z)(c,r,i,!1,null,"1dd4fe26",null),p=u.exports},59684:function(e,t,a){a.d(t,{A1:function(){return l},Jo:function(){return n},OE:function(){return p},PG:function(){return o},Qs:function(){return f},SN:function(){return c},XQ:function(){return i},b3:function(){return u},fC:function(){return s},fg:function(){return d},p2:function(){return m},w6:function(){return y}});var r=a(84471);const i=()=>(0,r.U)({url:"/resource/fetchAllResourceType",data:{}}),n=e=>(0,r.v)({url:"/resource/createResourceType",data:e}),s=e=>(0,r.v)({url:"/resource/deleteResourceType",params:{resource_type_id:e}}),o=e=>(0,r.U)({url:"/resource/fetchResource",data:{resource_type_id:e}}),l=()=>(0,r.U)({url:"/resource/fetchAllResources",data:{}}),c=e=>(0,r.v)({url:"/resource/createResource",data:e}),d=e=>(0,r.v)({url:"/resource/deleteResource",params:{resource_id:e}}),u=()=>(0,r.U)({url:"/dataType/fetchAllDataType",data:{}}),p=e=>(0,r.v)({url:"/dataType/createDataType",data:e}),m=e=>(0,r.v)({url:"/dataType/deleteDataType",params:{data_type_id:e}}),y=e=>(0,r.U)({url:"/relation/fetchTasksByResource",data:{resource_id:e}}),f=e=>(0,r.v)({url:"/relation/deleteTaskFromResource",data:e})},60773:function(e,t,a){a.d(t,{VV:function(){return r},rD:function(){return i}});const r=[{title:"任务类型ID",dataIndex:"id",key:"id",scopedSlots:{customRender:"id"}},{title:"任务类型名称",dataIndex:"name",key:"name",ellipsis:!0},{title:"任务类型描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"关联的任务属性",dataIndex:"attributes",key:"attributes",scopedSlots:{customRender:"attributes"},ellipsis:!0},{title:"操作",dataIndex:"action",key:"action",scopedSlots:{customRender:"action"}}],i=[{title:"资源类型ID",dataIndex:"id",key:"id"},{title:"资源类型名称",dataIndex:"name",key:"name",ellipsis:!0},{title:"资源类型描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"关联的资源属性",dataIndex:"attributes",key:"attributes",ellipsis:!0},{title:"操作",dataIndex:"action",key:"action"}]},42325:function(e,t,a){a.d(t,{d:function(){return r}});const r=e=>200===e.code},84471:function(e,t,a){a.d(t,{U:function(){return s},v:function(){return o}});var r=a(44161);const i=r.Z.create({baseURL:"//81.70.164.10:8750/"});function n({url:e,data:t,method:a,config:r,params:n}){const s=e=>200===e.data.code?e.data:Promise.reject(e.data),o=e=>{throw new Error(e?.message||"Error")};if(a=a||"GET","GET"===a){const a=Object.assign("function"===typeof t?t():t??{},{});return i.get(e,{params:a,...r}).then(s,o)}if("POST"===a){if(t)return i.post(e,t,r).then(s,o);if(n)return i.post(e,null,{params:n,...r}).then(s,o)}}function s({url:e,data:t,method:a="GET"}){return n({url:e,method:a,data:t})}function o({url:e,data:t,params:a,method:r="POST"}){return n({url:e,method:r,params:a,data:t})}}}]);
//# sourceMappingURL=20.e2d742da.js.map