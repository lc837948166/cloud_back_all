"use strict";(self["webpackChunkkfront"]=self["webpackChunkkfront"]||[]).push([[727],{73727:function(e,t,a){a.r(t),a.d(t,{default:function(){return m}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"vmarea"},[t("el-row",{attrs:{gutter:0}},[t("el-col",{attrs:{span:10,offset:0}},[t("p",{staticStyle:{"font-size":"25px","font-weight":"600","margin-bottom":"20px"}},[e._v(" 虚拟机列表 ")])]),t("el-col",{attrs:{span:3,offset:9}},[t("el-button",{attrs:{icon:"el-icon-refresh",size:"medium",round:"",plain:""},on:{click:e.refreshIP}},[e._v("更新虚拟机ip地址 ")])],1),t("el-col",{attrs:{span:2,offset:0}},[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"medium",round:"",plain:""},on:{click:e.openCreateVM}},[e._v("新增虚拟机 ")])],1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.vmdata.slice((e.curpage-1)*e.pagesize,e.curpage*e.pagesize).filter((t=>!e.psearch||t.name.toLowerCase().includes(e.psearch.toLowerCase()))),"empty-text":"暂无虚拟机","header-cell-style":{background:"#00b8a9",color:"#fff"}}},[t("el-table-column",{attrs:{type:"index",label:"序号",width:"50"}}),t("el-table-column",{attrs:{width:"150",sortable:"",label:"名称",prop:"name"}}),t("el-table-column",{attrs:{width:"100",sortable:"",label:"状态",prop:"state"},scopedSlots:e._u([{key:"default",fn:function(a){return["VIR_DOMAIN_PAUSED"===a.row.state?t("el-tag",{attrs:{type:"warning"}},[e._v("挂起")]):"VIR_DOMAIN_RUNNING"===a.row.state?t("el-tag",[e._v("运行")]):t("el-tag",{attrs:{type:"danger"}},[e._v("关机")])]}}])}),t("el-table-column",{attrs:{width:"100",sortable:"",label:"cpu个数",prop:"cpuNum"}}),t("el-table-column",{attrs:{width:"140",sortable:"",label:"分配内存(GiB)",prop:"maxMem"}}),t("el-table-column",{attrs:{width:"180",sortable:"",label:"IP地址",prop:"ipaddr"}}),t("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button-group",[t("el-button",{attrs:{plain:"",type:"success"},on:{click:function(t){return e.vmstart(a.row)}}},[e._v("启动")]),t("el-button",{attrs:{plain:"",type:"warning"},on:{click:function(t){return e.vmsuspend(a.row)}}},[e._v("挂起")]),t("el-button",{attrs:{plain:"",type:"success"},on:{click:function(t){return e.vmresume(a.row)}}},[e._v("还原")]),t("el-button",{attrs:{plain:"",type:"primary"},on:{click:function(t){return e.vmreboot(a.row)}}},[e._v("重启")]),t("el-button",{attrs:{plain:"",type:"info"},on:{click:function(t){return e.vmshutdown(a.row)}}},[e._v("关闭")]),t("el-button",{attrs:{plain:"",type:"danger"},on:{click:function(t){return e.vmshutdownMust(a.row)}}},[e._v("强制关闭")]),t("el-button",{attrs:{plain:"",type:"danger"},on:{click:function(t){return e.vmdelete(a.row)}}},[e._v("删除")]),t("el-button",{attrs:{plain:"",type:"warning"},on:{click:function(t){return e.opencommand(a.row)}}},[e._v("执行命令")]),t("el-button",{attrs:{plain:"",type:"primary"},on:{click:function(t){return e.openpod(a.row)}}},[e._v("容器管理")]),t("el-button",{attrs:{plain:"",type:"primary"},on:{click:function(t){return e.openimage(a.row)}}},[e._v("镜像管理")])],1)]}}])},[t("template",{slot:"header"},[t("el-input",{staticStyle:{width:"30%"},attrs:{placeholder:"输入名称搜索"},model:{value:e.psearch,callback:function(t){e.psearch=t},expression:"psearch"}})],1)],2)],1),0!=e.vmdata.length?t("div",{staticStyle:{"margin-top":"30px"}},[t("el-pagination",{attrs:{"current-page":e.curpage,"page-sizes":[10,20,30,40,50],"page-size":e.pagesize,layout:"sizes, total, prev, pager, next, jumper",total:e.totalvm,background:""},on:{"update:currentPage":function(t){e.curpage=t},"update:current-page":function(t){e.curpage=t},"update:pageSize":function(t){e.pagesize=t},"update:page-size":function(t){e.pagesize=t}}})],1):e._e(),t("el-dialog",{attrs:{title:"创建虚拟机",visible:e.buildvmvisible},on:{"update:visible":function(t){e.buildvmvisible=t}}},[t("el-form",{ref:"formData",attrs:{"label-position":"top","label-width":"80px",model:e.formData,"status-icon":!0,rules:e.vm_rules}},[t("el-row",{attrs:{gutter:30}},[t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"虚拟机名称",prop:"name"}},[t("el-input",{staticStyle:{width:"60%"},attrs:{placeholder:"请输入虚拟机名称"},on:{blur:function(t){return e.validName()}},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1)],1),t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"内存",prop:"memory"}},[t("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",placeholder:"请选择内存大小(GiB)"},model:{value:e.formData.memory,callback:function(t){e.$set(e.formData,"memory",t)},expression:"formData.memory"}},e._l(e.memory_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:30}},[t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"CPU个数",prop:"cpuNum"}},[t("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",placeholder:"请选择CPU个数"},model:{value:e.formData.cpuNum,callback:function(t){e.$set(e.formData,"cpuNum",t)},expression:"formData.cpuNum"}},e._l(e.cpunum_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"系统类型",prop:"OStype"}},[t("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",placeholder:"请选择系统类型"},model:{value:e.formData.OStype,callback:function(t){e.$set(e.formData,"OStype",t)},expression:"formData.OStype"}},e._l(e.ostype_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:30}},[t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"虚拟机镜像,#仅支持qcow2格式",prop:"ImgName"}},[t("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",placeholder:"请选择虚拟机镜像"},on:{"visible-change":e.nsremote},model:{value:e.formData.ImgName,callback:function(t){e.$set(e.formData,"ImgName",t)},expression:"formData.ImgName"}},e._l(e.images,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"节点",prop:"node"}},[t("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",placeholder:"请选择创建虚拟机所在宿主机节点"},model:{value:e.formData.node,callback:function(t){e.$set(e.formData,"node",t)},expression:"formData.node"}},e._l(e.node_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",{attrs:{gutter:30}},[t("el-col",{attrs:{span:12,offset:0}},[t("el-form-item",{attrs:{label:"网络类型",prop:"nettype"}},[t("el-select",{staticStyle:{width:"60%"},attrs:{clearable:"",placeholder:"请选择创建虚拟机的网络类型"},model:{value:e.formData.nettype,callback:function(t){e.$set(e.formData,"nettype",t)},expression:"formData.nettype"}},e._l(e.nettype_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-form-item",{attrs:{size:"large"}},[t("div",{staticClass:"vmc-sbm-area"},[t("el-button",{attrs:{round:""},on:{click:function(t){return e.resetForm("formData")}}},[e._v("清空输入")]),t("el-button",{attrs:{round:"",type:"primary"},on:{click:function(t){return e.vmc_sumbit("formData")}}},[e._v("立即创建")])],1)])],1)],1),t("el-dialog",{attrs:{title:"执行命令",visible:e.commandvisible},on:{"update:visible":function(t){e.commandvisible=t}}},[t("el-descriptions",{attrs:{title:"虚拟机信息"}},[t("el-descriptions-item",{attrs:{label:"名称"}},[e._v(e._s(this.command_tmp_data.name))]),t("el-descriptions-item",{attrs:{label:"状态"}},["VIR_DOMAIN_PAUSED"===this.command_tmp_data.state?t("el-tag",{attrs:{type:"warning"}},[e._v("挂起")]):"VIR_DOMAIN_RUNNING"===this.command_tmp_data.state?t("el-tag",[e._v("运行")]):t("el-tag",{attrs:{type:"danger"}},[e._v("关机")])],1),t("el-descriptions-item",{attrs:{label:"cpu个数"}},[e._v(e._s(this.command_tmp_data.cpuNum))]),t("el-descriptions-item",{attrs:{label:"分配内存(GiB)"}},[e._v(e._s(this.command_tmp_data.maxMem))]),t("el-descriptions-item",{attrs:{label:"IP地址"}},[e._v(e._s(this.command_tmp_data.ipaddr))])],1),t("el-form",{ref:"commandForm",attrs:{"label-position":"top","label-width":"80px",model:e.commandForm,"status-icon":!0,rules:e.command_rules}},[t("el-form-item",{attrs:{label:"命令",prop:"command"}},[t("el-input",{attrs:{placeholder:"请输入要执行的命令",type:"textarea",rows:4,clearable:""},model:{value:e.commandForm.command,callback:function(t){e.$set(e.commandForm,"command",t)},expression:"commandForm.command"}})],1),t("el-form-item",{attrs:{prop:"result"}},[t("template",{slot:"label"},[e._v(" 执行结果 ")]),t("el-input",{attrs:{placeholder:"命令执行的结果将会显示在这里",type:"textarea",rows:4,clearable:""},model:{value:e.commandForm.result,callback:function(t){e.$set(e.commandForm,"result",t)},expression:"commandForm.result"}})],2),t("el-form-item",{attrs:{prop:"res_state"}},[t("div",{staticStyle:{float:"right"}},["yes"===this.commandForm.res_state?t("span",{staticStyle:{color:"#67c23a","font-size":"15px"}},[t("i",{staticClass:"el-icon-success"}),e._v("执行成功")]):e._e(),"no"===this.commandForm.res_state?t("span",{staticStyle:{color:"#f56c6c","font-size":"15px"}},[t("i",{staticClass:"el-icon-error"}),e._v("执行出错")]):e._e()])]),t("el-form-item",{attrs:{size:"large"}},[t("div",{staticClass:"vmc-sbm-area",staticStyle:{"text-align":"right","margin-top":"50px"}},[t("el-button",{attrs:{round:""},on:{click:function(t){return e.resetForm("commandForm")}}},[e._v("清空输入")]),t("el-button",{attrs:{round:"",type:"primary"},on:{click:function(t){return e.start_command("commandForm")}}},[e._v("立即执行")])],1)])],1)],1),t("el-drawer",{directives:[{name:"loading",rawName:"v-loading",value:e.fullloading,expression:"fullloading"}],attrs:{visible:e.imagedrawer,direction:"ttb",size:"90%"},on:{"update:visible":function(t){e.imagedrawer=t},open:e.imgdopen}},[t("div",{attrs:{slot:"title"},slot:"title"},[t("el-row",{attrs:{gutter:0}},[t("el-col",{attrs:{span:5,offset:0}},[t("p",{staticStyle:{"font-size":"25px","font-weight":"600","margin-bottom":"0px"}},[e._v(" "+e._s(e.vmimg_tmp_data.name)+"-容器镜像列表 ")])]),t("el-col",{attrs:{span:3,offset:0}},[t("el-select",{staticStyle:{width:"80%"},attrs:{clearable:"",placeholder:"请选择要上传的镜像"},on:{"visible-change":e.getimg},model:{value:e.iamgename,callback:function(t){e.iamgename=t},expression:"iamgename"}},e._l(e.img_list,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-col",{attrs:{span:2,offset:0}},[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"medium",round:"",plain:""},on:{click:e.uploadImgToVm}},[e._v("上传镜像到虚拟机")])],1)],1)],1),t("div",{staticStyle:{"margin-left":"20px","margin-right":"20px"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.cidata.filter((t=>!e.pcisearch||t.repository.toLowerCase().includes(e.pcisearch.toLowerCase()))),height:"700","empty-text":"暂无容器镜像","header-cell-style":{background:"#00b8a9",color:"#fff"}}},[t("el-table-column",{attrs:{width:"80",type:"index",label:"序号"}}),t("el-table-column",{attrs:{width:"500",sortable:"",label:"仓库/镜像名",prop:"repository"}}),t("el-table-column",{attrs:{width:"300",sortable:"",label:"标签",prop:"tag"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"镜像ID",prop:"imageid"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"创建时间",prop:"created"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"体积",prop:"size"}}),t("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticStyle:{"text-align":"center"}},[t("el-button",{attrs:{plain:"",type:"success"},on:{click:function(t){return e.startimage(a.$index,a.row)}}},[e._v("启动镜像")]),t("el-button",{attrs:{plain:"",type:"danger"},on:{click:function(t){return e.deleteimage(a.$index,a.row)}}},[e._v("删除")])],1)]}}])},[t("template",{slot:"header"},[t("el-input",{attrs:{size:"mini",placeholder:"输入名称搜索"},model:{value:e.pcisearch,callback:function(t){e.pcisearch=t},expression:"pcisearch"}})],1)],2)],1)],1)]),t("el-drawer",{directives:[{name:"loading",rawName:"v-loading",value:e.fullloading,expression:"fullloading"}],attrs:{visible:e.poddrawer,direction:"ttb",size:"90%"},on:{"update:visible":function(t){e.poddrawer=t},open:e.podopen}},[t("div",{attrs:{slot:"title"},slot:"title"},[t("el-row",{attrs:{gutter:0}},[t("el-col",{attrs:{span:5,offset:0}},[t("p",{staticStyle:{"font-size":"25px","font-weight":"600","margin-bottom":"0px"}},[e._v(" "+e._s(e.vmpod_tmp_data.name)+"-容器列表 ")])])],1)],1),t("div",{staticStyle:{"margin-left":"20px","margin-right":"20px"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.poddata.filter((t=>!e.ppodsearch||t.image.toLowerCase().includes(e.ppodsearch.toLowerCase()))),height:"700","empty-text":"暂无容器","header-cell-style":{background:"#00b8a9",color:"#fff"}}},[t("el-table-column",{attrs:{width:"80",type:"index",label:"序号"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"容器ID",prop:"conid"}}),t("el-table-column",{attrs:{width:"300",sortable:"",label:"镜像",prop:"image"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"命令",prop:"command"}}),t("el-table-column",{attrs:{width:"300",sortable:"",label:"创建时间",prop:"created"}}),t("el-table-column",{attrs:{width:"300",sortable:"",label:"状态",prop:"status"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"名字",prop:"names"}}),t("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticStyle:{"text-align":"center"}},[t("el-button-group",[t("el-button",{attrs:{plain:"",type:"success"},on:{click:function(t){return e.startpod(a.$index,a.row)}}},[e._v("启动")]),t("el-button",{attrs:{plain:"",type:"warning"},on:{click:function(t){return e.stoppod(a.$index,a.row)}}},[e._v("停止")]),t("el-button",{attrs:{plain:"",type:"danger"},on:{click:function(t){return e.deletepod(a.$index,a.row)}}},[e._v("删除")])],1)],1)]}}])},[t("template",{slot:"header"},[t("el-input",{attrs:{size:"mini",placeholder:"输入名称搜索"},model:{value:e.ppodsearch,callback:function(t){e.ppodsearch=t},expression:"ppodsearch"}})],1)],2)],1)],1)])],1)},o=[],r=(a(70560),{name:"VMList",mounted(){this.getVMList("http://"+this.$store.state.nodeip+":8080")},data(){return{poddrawer:!1,imagedrawer:!1,res_state:"",baseurl:"http://"+this.$store.state.nodeip+":8080",execurl:"http://"+this.$store.state.nodeip+":8081",vmdata:[],psearch:"",serverip:"",images:[],curpage:1,totalvm:0,pagesize:10,formInline:{},buildvmvisible:!1,commandvisible:!1,command_tmp_data:{name:"无",state:"无",cpuNum:"无",ipaddr:"无",maxMem:"无"},nettype_options:[{label:"bridge",value:"bridge"},{label:"nat",value:"nat"}],node_options:[{label:"云节点:39.98.124.97",value:"192.168.194.178"},{label:"端节点1:192.168.194.45",value:"192.168.194.45"},{label:"端节点2:192.168.194.164",value:"192.168.194.164"}],ostype_options:[{label:"x86",value:"X86"},{label:"arm",value:"arm"}],cpunum_options:[{label:"1 个",value:"1"},{label:"2 个",value:"2"},{label:"4 个",value:"4"},{label:"6 个",value:"6"},{label:"8 个",value:"8"},{label:"10 个",value:"10"}],memory_options:[{label:"1 GiB",value:"1"},{label:"2 GiB",value:"2"},{label:"4 GiB",value:"4"},{label:"6 GiB",value:"6"},{label:"8 GiB",value:"8"},{label:"16 GiB",value:"16"},{label:"24 GiB",value:"24"},{label:"32 GiB",value:"32"}],edgeserver_options:[{label:"端1",value:"worker1"}],pod_options:[{label:"容器1",value:"pod1"}],formData:{name:"",memory:"",cpuNum:"",OStype:"",node:"",nettype:""},commandForm:{command:"",edgeserver:"",pod:"",res_state:"",result:""},vm_rules:{name:[{required:!0,message:"请输入虚拟机名称",trigger:"blur"}],memory:[{required:!0,message:"请选择内存大小",trigger:"change"}],node:[{required:!0,message:"请选择创建虚拟机所在的节点",trigger:"change"}],nettype:[{required:!0,message:"请选择创建虚拟机的网络类型",trigger:"change"}],cpuNum:[{required:!0,message:"请选择CPU个数",trigger:"change"}],OStype:[{required:!0,message:"请选择系统类型",trigger:"change"}]},command_rules:{command:[{required:!0,message:"请输入命令",trigger:"blur"}]},vmpod_tmp_data:{},vmimg_tmp_data:{},cidata:[],pcisearch:"",iamgename:"",img_list:[],fullloading:!1,poddata:[],ppodsearch:""}},methods:{deletepod(e,t){this.$axios.delete(this.baseurl+"/docker/deleteContainer?vmName="+this.vmpod_tmp_data.name+"&endIp="+this.$store.state.nodeip+"&containerId="+t.conid).then((e=>{0==e.data.exitStatus?(this.$message({message:"容器"+t.conid+"删除成功",type:"success"}),this.get_vm_pod()):this.$message({message:e.data.errorOutput,type:"error"})})).catch((e=>{console.log("errors",e),this.$message({message:"删除失败，请检查网络设置",type:"error"})}))},stoppod(e,t){this.$axios.post(this.baseurl+"/docker/stopContainer?vmName="+this.vmpod_tmp_data.name+"&endIp="+this.$store.state.nodeip+"&containerId="+t.conid).then((e=>{0==e.data.exitStatus?(this.$message({message:"容器"+t.conid+"停止成功",type:"success"}),this.get_vm_pod()):this.$message({message:e.data.errorOutput,type:"error"})})).catch((e=>{console.log("errors",e),this.$message({message:"停止失败，请检查网络设置",type:"error"})}))},startpod(e,t){this.$axios.post(this.baseurl+"/docker/startContainer?vmName="+this.vmpod_tmp_data.name+"&endIp="+this.$store.state.nodeip+"&containerId="+t.conid).then((e=>{0==e.data.exitStatus?(this.$message({message:"容器"+t.conid+"启动成功",type:"success"}),this.get_vm_pod()):this.$message({message:e.data.errorOutput,type:"error"})})).catch((e=>{console.log("errors",e),this.$message({message:"启动失败，请检查网络设置",type:"error"})}))},deleteimage(e,t){this.$axios.delete(this.baseurl+"/docker/deleteImage?vmName="+this.vmimg_tmp_data.name+"&endIp="+this.$store.state.nodeip+"&imageName="+t.repository+":"+t.tag).then((e=>{0==e.data.exitStatus?(this.$message({message:"镜像"+t.repository+"删除成功",type:"success"}),this.get_vm_img()):this.$message({message:e.data.errorOutput,type:"error"})})).catch((e=>{console.log("errors",e),this.$message({message:"删除失败，请检查网络设置",type:"error"})}))},startimage(e,t){this.$prompt("请输入启动命令","启动提示",{confirmButtonText:"启动",cancelButtonText:"取消",inputPlaceholder:"请输入启动命令",inputValue:"docker run -d "+t.repository+":"+t.tag}).then((({value:e})=>{this.$axios.post(this.baseurl+"/docker/run?vmName="+this.vmimg_tmp_data.name+"&endIp="+this.$store.state.nodeip+"&command="+e).then((e=>{0==e.data.exitStatus?(this.$message({message:"镜像"+t.repository+"启动成功",type:"success"}),this.get_vm_img()):this.$message({message:e.data.errorOutput,type:"error"})})).catch((e=>{console.log("errors",e),this.$message({message:"启动失败，请检查网络设置",type:"error"})}))}))},uploadImgToVm(){""===this.iamgename?this.$message({message:"请先选择要上传的镜像",type:"error"}):(this.fullloading=!0,this.$axios.post(this.baseurl+"/docker/mkdir?vmName="+this.vmimg_tmp_data.name+"&endIp="+this.$store.state.nodeip+"&targetPath=/testimg").then((e=>{0==e.data.exitStatus?this.$axios.post(this.baseurl+"/docker/upload?vmName="+this.vmimg_tmp_data.name+"&endIp="+this.$store.state.nodeip+"&fileName="+this.iamgename+"&targetPath=/testimg&sourceIp=39.98.124.97").then((e=>{0==e.data.exitStatus?(this.$message({message:"上传成功，等待导入到Docker",type:"success"}),this.$axios.post(this.baseurl+"/docker/import?vmName="+this.vmimg_tmp_data.name+"&endIp="+this.$store.state.nodeip+"&targetPath=/testimg/&imageFileName="+this.iamgename).then((e=>{0==e.data.exitStatus?(this.$message({message:"导入镜像"+this.iamgename+"成功",type:"success"}),this.fullloading=!1,this.get_vm_img()):"Command execution timed out or the file is still uploading."!=e.data.errorOutput?this.$message({message:e.data.errorOutput,type:"error"}):(this.$message({message:"镜像"+this.iamgename+"导入进行中，请稍后查看",type:"success"}),this.fullloading=!1,this.get_vm_img())})).catch((e=>{console.log("errors",e),this.$message({message:"导入失败，请检查网络设置",type:"error"})}))):this.$message({message:e.data.errorOutput,type:"error"})})).catch((e=>{console.log("errors",e),this.$message({message:"上传失败，请检查网络设置",type:"error"})})):this.$message({message:"创建文件夹失败，请检查虚拟机目录",type:"error"})})).catch((e=>{console.log("errors",e),this.$message({message:"创建文件夹失败，请检查网络问题",type:"error"})})))},getimg(){this.img_list=[],this.$axios.get("http://39.98.124.97:8081/api/ssh/imgListByIP?ip=39.98.124.97").then((e=>{let t=e.data.output.split("\n");t.pop();for(let a=0;a<t.length;a++)this.img_list.push({label:t[a],value:t[a]})})).catch((e=>{console.log("errors",e)}))},imgdopen(){this.cidata=[],this.iamgename="",this.img_list=[],this.get_vm_img()},podopen(){this.poddata=[],this.get_vm_pod()},get_vm_pod(){this.$axios.get(this.baseurl+"/docker/containerList?vmName="+this.vmpod_tmp_data.name+"&endIp="+this.$store.state.nodeip).then((e=>{this.poddata=this.data_resolver_pod(JSON.parse(e.data[0]).output)})).catch((e=>{console.log("errors",e)}))},get_vm_img(){this.$axios.get(this.baseurl+"/docker/imageList?vmName="+this.vmimg_tmp_data.name+"&endIp="+this.$store.state.nodeip).then((e=>{this.cidata=this.data_resolver_image(JSON.parse(e.data[0]).output)})).catch((e=>{console.log("errors",e)}))},data_resolver_pod(e){let t=[],a=e.split("\n"),s=1;for(;s<a.length-1;s++){let e=a[s].split("   ");e=e.filter((function(e){return""!==e})),t.push({conid:e[0],image:e[1],command:e[2],created:e[3],status:e[4],ports:"",names:e[5]})}return t},data_resolver_image(e){let t=[],a=e.split("\n"),s=1;for(;s<a.length-1;s++){let e=a[s].split("   ");e=e.filter((function(e){return""!==e})),t.push({repository:e[0],tag:e[1],imageid:e[2],created:e[3],size:e[4]})}return t},openpod(e){this.poddrawer=!0,this.vmpod_tmp_data=e},openimage(e){this.imagedrawer=!0,this.vmimg_tmp_data=e},start_command(e){this.$refs[e].validate((e=>{if(!e)return console.log("表单验证不通过"),!1;this.$axios({method:"post",url:this.execurl+"/api/ssh/execute",data:{VMname:this.command_tmp_data.name,commands:this.commandForm.command.split("\n")},headers:{"Content-Type":"application/json"}}).then((e=>{console.log(e),0===e.data.exitStatus?(this.commandForm.res_state="yes",this.commandForm.result=e.data.output):(this.commandForm.res_state="no",this.commandForm.result=e.data.errorOutput)}),(e=>{console.log(e),this.commandForm.result="网络错误，请检查网络",this.commandForm.res_state="no"}))}))},suzhuchange(e){this.serverip=e,this.baseurl="http://"+this.serverip+":8080",this.execurl="http://"+this.serverip+":8081",this.getVMList()},opencommand(e){this.commandvisible=!0,this.command_tmp_data=e},getVMList(e){this.$axios.get(e+"/getVMList").then((e=>{this.vmdata=e.data,this.totalvm=e.data.length})).catch((e=>{console.log("errors",e)}))},openCreateVM(){this.buildvmvisible=!0},refreshIP(){this.$axios.get(this.baseurl+"/VMInfo/updateip/"+this.$store.state.nodeip).then((e=>{const t=e.data;t.success?(this.$message.success("更新成功！"),this.getVMList()):this.$message.success("更新失败！")}))},validName(){this.formData.name.includes(".")&&this.$notify.error({message:"虚拟机名字不能包括特殊字符"})},nsremote(){this.$axios.get(this.baseurl+"/Images/imgList").then((e=>{let t=[];for(let a=0;a<e.data.content.length;a++){let s={};s["label"]=e.data.content[a].name,s["value"]=e.data.content[a].name,t.push(s)}this.images=t})).catch((e=>{console.log("errors",e)}))},vmc_sumbit(e){this.$refs[e].validate((e=>{if(!e)return console.log("表单验证不通过"),!1;this.buildvmvisible=!1,this.$axios.get(this.baseurl+"/addVirtual?ImgName="+this.formData.ImgName+"&name="+this.formData.name+"&memory="+this.formData.memory+"&cpuNum="+this.formData.cpuNum+"&OStype="+this.formData.OStype+"&nettype="+this.formData.nettype+"&serverip="+this.formData.node).then((e=>{!1===e.data.success?this.$notify.error({title:"创建虚拟机失败",message:e.data.msg,position:"bottom-right"}):this.$notify.success({title:"创建虚拟机成功",message:"创建虚拟机"+this.formData.name+"成功",position:"bottom-right"}),this.getVMList()})).catch((e=>{this.$notify.error({title:"创建失败",message:e,position:"bottom-right",duration:6e3})}))}))},resetForm(e){this.$refs[e].resetFields()},vmstart(e){this.$axios.get(this.baseurl+"/initiate/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("启动成功！"),this.getVMList()):this.$message.success("启动失败！")}))},vmsuspend(e){this.$axios.get(this.baseurl+"/suspended/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("挂起成功！"),this.getVMList()):this.$message.success("挂起失败！")}))},vmresume(e){this.$axios.get(this.baseurl+"/resume/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("还原成功！"),this.getVMList()):this.$message.success("还原失败！")}))},vmreboot(e){this.$axios.get(this.baseurl+"/reboot/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("重启中..."),this.getVMList()):this.$message.success("重启失败！")}))},vmshutdown(e){this.$axios.get(this.baseurl+"/shutdown/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("关机成功！"),this.getVMList()):this.$message.success("关机失败！")}))},vmshutdownMust(e){this.$confirm("您确定强行关机吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$axios.get(this.baseurl+"/shutdownMust/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("强行关机成功！"),this.getVMList()):this.$message.success("强行关机失败！")}))})).catch((()=>{this.$message({type:"info",message:"已取消"})}))},vmdelete(e){this.$confirm("您确定删除该虚拟机吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$axios.delete(this.baseurl+"/delete/"+e.name).then((e=>{const t=e.data;t.success?(this.$message.success("删除成功！"),this.getVMList()):this.$message.success("删除失败！")}))})).catch((()=>{this.$message({type:"info",message:"已取消"})}))}},computed:{tmp_nodename_w(){return this.$store.state.nodename}},watch:{tmp_nodename_w(e,t){this.vmdata=[],this.totalvm=this.vmdata.length,this.getVMList("http://"+this.$store.state.nodeip+":8080")}}}),i=r,l=a(1001),n=(0,l.Z)(i,s,o,!1,null,null,null),m=n.exports}}]);
//# sourceMappingURL=727.3516897d.js.map