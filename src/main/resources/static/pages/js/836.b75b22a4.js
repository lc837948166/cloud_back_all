"use strict";(self["webpackChunkkfront"]=self["webpackChunkkfront"]||[]).push([[836],{28836:function(t,e,a){a.r(e),a.d(e,{default:function(){return u}});var i=function(){var t=this,e=t._self._c;return e("div",[e("div",[e("div",{staticStyle:{padding:"10px"}},[e("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.addTaskType}},[t._v("新增任务类型")]),e("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.addTaskDataType}},[t._v("新增数据类型")])],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],attrs:{data:t.taskTypeData}},[e("el-table-column",{attrs:{prop:"id",label:"任务类型ID",width:"180"}}),e("el-table-column",{attrs:{prop:"name",label:"任务类型名称"}}),e("el-table-column",{attrs:{prop:"description",label:"任务类型描述"}}),e("el-table-column",{attrs:{prop:"attributes",label:"关联的任务属性"},scopedSlots:t._u([{key:"default",fn:function(a){return t._l(a.row.attributes,(function(a,i){return e("span",[t._v(t._s(i)+"："+t._s(a.info)+" "),e("br")])}))}}])}),e("el-table-column",{attrs:{prop:"action",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-popconfirm",{attrs:{title:"是否确认删除该任务类型？确认后会删除任务类型关联下的所有任务"},on:{confirm:()=>t.confirmDelete(a.row)}},[e("el-button",{attrs:{slot:"reference",type:"danger",plain:""},slot:"reference"},[t._v("删除")])],1),e("el-divider",{attrs:{direction:"vertical"}}),e("el-button",{attrs:{type:"primary",plain:""},on:{click:()=>t.gotoTask(a.row)}},[t._v("查看绑定的任务")])]}}])})],1),e("el-drawer",{attrs:{visible:t.open,title:"新增任务类型",size:"40%","show-close":!1},on:{"update:visible":function(e){t.open=e}}},[e("div",{staticStyle:{position:"absolute",top:"10px",right:"10px"}},[e("el-button",{staticStyle:{"margin-right":"8px"},on:{click:t.onClose}},[t._v("取消")]),e("el-button",{attrs:{loading:t.submitLoading,type:"primary"},on:{click:t.submit}},[t._v("提交")])],1),e("el-form",{ref:"dynamicValidateForm",staticStyle:{padding:"10px"},attrs:{model:t.dynamicValidateForm,"label-width":"120px"}},[e("el-form-item",{attrs:{rules:{required:!0,message:"缺少任务类型名称"},label:"任务类型名称",prop:"name"}},[e("el-input",{model:{value:t.dynamicValidateForm.name,callback:function(e){t.$set(t.dynamicValidateForm,"name",e)},expression:"dynamicValidateForm.name"}})],1),e("el-form-item",{attrs:{rules:{required:!0,message:"缺少任务类型描述"},label:"任务类型描述",prop:"description"}},[e("el-input",{model:{value:t.dynamicValidateForm.description,callback:function(e){t.$set(t.dynamicValidateForm,"description",e)},expression:"dynamicValidateForm.description"}})],1),t._l(t.dynamicValidateForm.attributes,(function(a,i){return e("div",{key:a.id,staticStyle:{display:"flex","margin-bottom":"8px"}},[e("el-form-item",{attrs:{"label-width":"12px",prop:["attributes",i,"info"].join("."),rules:{required:!0,message:"缺少任务属性中文名称"}}},[e("el-input",{attrs:{placeholder:"任务属性中文名称"},model:{value:a.info,callback:function(e){t.$set(a,"info",e)},expression:"attribute.info"}})],1),e("el-form-item",{attrs:{"label-width":"12px",prop:["attributes",i,"name"].join("."),rules:{required:!0,validator:t.checkEnglishName}}},[e("el-input",{attrs:{placeholder:"任务属性英文名称"},model:{value:a.name,callback:function(e){t.$set(a,"name",e)},expression:"attribute.name"}})],1),e("el-form-item",{attrs:{"label-width":"12px",prop:["attributes",i,"data_type"].join("."),rules:{required:!0,message:"缺少任务属性类型"}}},[e("el-select",{staticStyle:{"min-width":"120px"},attrs:{placeholder:"任务属性类型"},model:{value:a.data_type,callback:function(e){t.$set(a,"data_type",e)},expression:"attribute.data_type"}},t._l(t.taskTypeOptions,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),e("el-button",{staticStyle:{height:"40px","margin-left":"12px"},attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(e){return t.removeAttribute(a)}}})],1)})),e("el-button",{staticStyle:{width:"100%"},attrs:{icon:"el-icon-plus"},on:{click:t.addAttribute}},[t._v(" 新增任务类型属性 ")])],2)],1),e("el-drawer",{attrs:{visible:t.dataTypeOpen,title:"新增数据类型",size:"40%","show-close":!1},on:{"update:visible":function(e){t.dataTypeOpen=e}}},[e("div",{staticStyle:{position:"absolute",top:"10px",right:"10px"}},[e("el-button",{staticStyle:{"margin-right":"8px"},on:{click:t.onDataTypeClose}},[t._v("取消")]),e("el-button",{attrs:{loading:t.dataTypeLoading,type:"primary"},on:{click:t.submitAddDataType}},[t._v("新增")])],1),e("el-form",{ref:"dataTypeForm",staticStyle:{padding:"10px"},attrs:{model:t.dataTypeForm,"label-width":"120px"}},[e("el-form-item",{attrs:{rules:{required:!0,message:"缺少数据类型中文名"},label:"数据类型中文名",prop:"info"}},[e("el-input",{model:{value:t.dataTypeForm.info,callback:function(e){t.$set(t.dataTypeForm,"info",e)},expression:"dataTypeForm.info"}})],1),e("el-form-item",{attrs:{rules:{required:!0,message:"缺少数据类型英文名"},label:"数据类型英文名",prop:"name"}},[e("el-input",{attrs:{placeholder:"现在仅支持string, int, float, boolean"},model:{value:t.dataTypeForm.name,callback:function(e){t.$set(t.dataTypeForm,"name",e)},expression:"dataTypeForm.name"}})],1)],1),e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableDataLoading,expression:"tableDataLoading"}],attrs:{data:t.taskDataTypeData}},[e("el-table-column",{attrs:{prop:"info",label:"数据类型中文名"}}),e("el-table-column",{attrs:{prop:"name",label:"数据类型英文名"}}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-popconfirm",{attrs:{title:"是否确认删除该数据类型？"},on:{confirm:()=>t.confirmDeleteDataType(a.row)}},[e("el-button",{attrs:{slot:"reference",type:"danger",plain:""},slot:"reference"},[t._v("删除")])],1)]}}])})],1)],1)],1)])},n=[],s=(a(70560),a(60773)),r=a(22402),o=a(42325),l={name:"TaskTypeManage",data(){return{taskTypeColumns:s.VV,open:!1,taskTypeData:[],taskDataTypeData:[],tableLoading:!1,tableDataLoading:!1,submitLoading:!1,dataTypeLoading:!1,dataTypeOpen:!1,dataTypeForm:{name:"",info:""},dynamicValidateForm:{name:"",description:"",attributes:[]}}},computed:{taskTypeOptions(){return this.taskDataTypeData.map((t=>({label:t.info,value:t.id})))}},watch:{open(t){t&&(this.$refs.dynamicValidateForm?.resetFields(),this.dynamicValidateForm.attributes=[])},dataTypeOpen(t){t&&(this.$refs.dataTypeForm?.resetFields(),this.dataTypeForm.info="",this.dataTypeForm.name="")}},methods:{addTaskType(){this.open=!0,this.getTaskDataType()},addTaskDataType(){this.dataTypeOpen=!0,this.getTaskDataType()},async getTaskDataType(){const t=await(0,r.b3)().catch((t=>t));if(!(0,o.d)(t))return this.$message.error(t.message||"请求失败");this.taskDataTypeData=t.data},async getTaskTypeData(){this.tableLoading=!0;const t=await(0,r.m7)().catch((t=>t));if(this.tableLoading=!1,!(0,o.d)(t))return this.$message.error(t.message||"请求失败");const e=t.data.map((t=>{const{id:e,name:a,description:i}=t.task_type;return{...t,id:e,name:a,description:i}}));this.taskTypeData=e},onClose(){this.open=!1},onDataTypeClose(){this.dataTypeOpen=!1},async submit(){this.submitLoading=!0,this.$refs.dynamicValidateForm.validate((async t=>{if(!t)return this.submitLoading=!1;const{attributes:e,info:a,name:i,description:n}=this.dynamicValidateForm,s={task_type:{name:i,info:a,description:n},attributes:e},l=await(0,r.sS)(s).catch((t=>t));if(!(0,o.d)(l))return this.submitLoading=!1,this.$message.error(l.message||"请求失败");this.submitLoading=!1,this.open=!1,this.$message.success("新增成功"),this.getTaskTypeData()}))},addAttribute(){this.dynamicValidateForm.attributes.push({name:"",data_type:void 0,info:""})},checkEnglishName(t,e,a){const i=/^[a-zA-Z0-9_]+$/;return e?i.test(e)?a():a(new Error("只能是英文数字和下划线")):a(new Error("任务属性英文名称不能为空"))},removeAttribute(t){const e=this.dynamicValidateForm.attributes.indexOf(t);-1!==e&&this.dynamicValidateForm.attributes.splice(e,1)},async confirmDelete({task_type:t}){const e=await(0,r.wz)(t.id).catch((t=>t));if(!(0,o.d)(e))return this.$message.error(e.message||"请求失败");this.$message.success("删除成功"),this.getTaskTypeData()},async submitAddDataType(){this.dataTypeLoading=!0,this.$refs.dataTypeForm.validate((async t=>{if(!t)return this.dataTypeLoading=!1;const{name:e,info:a}=this.dataTypeForm,i={name:e,info:a},n=await(0,r.OE)(i).catch((t=>t));if(!(0,o.d)(n))return this.dataTypeLoading=!1,this.$message.error(n.message||"请求失败");this.dataTypeLoading=!1,this.$message.success("新增成功"),this.dataTypeForm.name="",this.dataTypeForm.info="",this.$refs.dataTypeForm.resetFields(),this.getTaskDataType()}))},async confirmDeleteDataType({id:t}){const e=await(0,r.p2)(t).catch((t=>t));if(!(0,o.d)(e))return this.$message.error(e.message||"请求失败");this.$message.success("删除成功"),this.getTaskDataType()},gotoTask({task_type:t}){this.$router.push({name:"taskManage",query:{task_type_id:t.id}})}},mounted(){this.getTaskTypeData()}},d=l,p=a(1001),c=(0,p.Z)(d,i,n,!1,null,"697a3363",null),u=c.exports},22402:function(t,e,a){a.d(e,{Ki:function(){return y},OE:function(){return u},_5:function(){return p},b3:function(){return c},m7:function(){return n},p2:function(){return m},sS:function(){return s},tQ:function(){return o},vr:function(){return d},wZ:function(){return l},wz:function(){return r}});var i=a(84471);const n=()=>(0,i.U)({url:"/task/fetchAllTaskType",data:{}}),s=t=>(0,i.v)({url:"/task/createTaskType",data:t}),r=t=>(0,i.v)({url:"/task/deleteTaskType",params:{task_type_id:t}}),o=t=>(0,i.U)({url:"/task/fetchTask",data:{task_type_id:t}}),l=()=>(0,i.U)({url:"/task/fetchAllTasks",data:{}}),d=t=>(0,i.v)({url:"/task/createTask",data:t}),p=t=>(0,i.v)({url:"/task/deleteTask",params:{task_id:t}}),c=()=>(0,i.U)({url:"/dataType/fetchAllDataType",data:{}}),u=t=>(0,i.v)({url:"/dataType/createDataType",data:t}),m=t=>(0,i.v)({url:"/dataType/deleteDataType",params:{data_type_id:t}}),y=t=>(0,i.v)({url:"/relation/addTaskToResource",data:t})},60773:function(t,e,a){a.d(e,{VV:function(){return i},rD:function(){return n}});const i=[{title:"任务类型ID",dataIndex:"id",key:"id",scopedSlots:{customRender:"id"}},{title:"任务类型名称",dataIndex:"name",key:"name",ellipsis:!0},{title:"任务类型描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"关联的任务属性",dataIndex:"attributes",key:"attributes",scopedSlots:{customRender:"attributes"},ellipsis:!0},{title:"操作",dataIndex:"action",key:"action",scopedSlots:{customRender:"action"}}],n=[{title:"资源类型ID",dataIndex:"id",key:"id"},{title:"资源类型名称",dataIndex:"name",key:"name",ellipsis:!0},{title:"资源类型描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"关联的资源属性",dataIndex:"attributes",key:"attributes",ellipsis:!0},{title:"操作",dataIndex:"action",key:"action"}]},42325:function(t,e,a){a.d(e,{d:function(){return i}});const i=t=>200===t.code},84471:function(t,e,a){a.d(e,{U:function(){return r},v:function(){return o}});var i=a(44161);const n=i.Z.create({baseURL:"//81.70.164.10:8750/"});function s({url:t,data:e,method:a,config:i,params:s}){const r=t=>200===t.data.code?t.data:Promise.reject(t.data),o=t=>{throw new Error(t?.message||"Error")};if(a=a||"GET","GET"===a){const a=Object.assign("function"===typeof e?e():e??{},{});return n.get(t,{params:a,...i}).then(r,o)}if("POST"===a){if(e)return n.post(t,e,i).then(r,o);if(s)return n.post(t,null,{params:s,...i}).then(r,o)}}function r({url:t,data:e,method:a="GET"}){return s({url:t,method:a,data:e})}function o({url:t,data:e,params:a,method:i="POST"}){return s({url:t,method:i,params:a,data:e})}}}]);
//# sourceMappingURL=836.b75b22a4.js.map