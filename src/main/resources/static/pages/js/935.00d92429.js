"use strict";(self["webpackChunkkfront"]=self["webpackChunkkfront"]||[]).push([[935],{88935:function(e,t,a){a.r(t),a.d(t,{default:function(){return u}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"vmarea"},[t("el-row",{attrs:{gutter:0}},[t("el-col",{attrs:{span:10,offset:0}},[t("p",{staticStyle:{"font-size":"25px","font-weight":"600","margin-bottom":"20px"}},[e._v(" 容器镜像列表 ")])]),t("el-col",{attrs:{span:2,offset:12}},[t("el-button",{attrs:{icon:"el-icon-circle-plus-outline",size:"medium",round:"",plain:""},on:{click:e.openUploadImage}},[e._v("上传镜像")])],1)],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.cidata.slice((e.curpage-1)*e.pagesize,e.curpage*e.pagesize).filter((t=>!e.psearch||t.image.toLowerCase().includes(e.psearch.toLowerCase()))),"empty-text":"暂无容器镜像","header-cell-style":{background:"#00b8a9",color:"#fff"}},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{width:"80",type:"index",label:"序号"}}),t("el-table-column",{attrs:{width:"500",sortable:"",label:"镜像名称",prop:"imageName"}}),t("el-table-column",{attrs:{width:"300",sortable:"",label:"标签",prop:"imageTag"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"镜像ID",prop:"imageId"}}),t("el-table-column",{attrs:{width:"200",sortable:"",label:"体积",prop:"imageSize"}}),t("el-table-column",{attrs:{align:"right"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticStyle:{"text-align":"center"}},[t("el-button",{attrs:{plain:"",type:"danger"},on:{click:function(t){return e.deleteimage(a.$index,a.row)}}},[e._v("删除")])],1)]}}])},[t("template",{slot:"header"},[t("el-input",{attrs:{size:"mini",placeholder:"输入名称搜索"},model:{value:e.psearch,callback:function(t){e.psearch=t},expression:"psearch"}})],1)],2)],1),0!=e.cidata.length?t("div",{staticStyle:{"margin-top":"30px"}},[t("el-pagination",{attrs:{"current-page":e.curpage,"page-sizes":[10,20,30,40,50],"page-size":e.pagesize,layout:"sizes, total, prev, pager, next, jumper",total:e.totalci,background:""},on:{"update:currentPage":function(t){e.curpage=t},"update:current-page":function(t){e.curpage=t},"update:pageSize":function(t){e.pagesize=t},"update:page-size":function(t){e.pagesize=t}}})],1):e._e(),t("el-dialog",{attrs:{title:"上传镜像",visible:e.uploadimagevisible},on:{"update:visible":function(t){e.uploadimagevisible=t}}},[t("div",{staticStyle:{"text-align":"center"}},[t("el-upload",{ref:"upload",staticClass:"upload-demo",staticStyle:{width:"100%"},attrs:{drag:"",action:e.baseurl+"/containerd/uploadImage",data:e.formData,multiple:!1,accept:".tar","auto-upload":!0,limit:1,name:"tarFile","before-upload":e.handleBeforeUpload,"on-success":e.sucupload,"on-error":e.errupload}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),t("em",[e._v("点击上传")])]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("*只能上传.tar文件")])])],1)])],1)},s=[],o=(a(70560),{name:"ImageList",mounted(){this.formData.nodeName=this.$store.state.nodename,this.getVMList()},data(){return{baseurl:"http://39.98.124.97:8080",cidata:[],psearch:"",curpage:1,totalci:0,pagesize:10,uploadimagevisible:!1,reqData:{virtualMachineIp:"",userName:"",userPassword:"",imageId:""},formData:{nodeName:this.tmp_nodename_w}}},methods:{handleSelectionChange(e){console.log(e)},deleteimage(e,t){this.reqData.virtualMachineIp=this.formData.virtualMachineIp,this.reqData.userName=this.formData.userName,this.reqData.userPassword=this.formData.userPassword,this.reqData.imageId=t.imageid,console.log("row:"+t),this.$axios.post(this.baseurl+"/containerd/deleteImage?nodeName="+this.$store.state.nodename+"&imageId="+t.imageId).then((e=>{console.log(e),"I"===e.data[0]?(this.$notify.success({title:"删除成功",message:"镜像删除成功",position:"bottom-right",duration:6e3}),this.getVMList()):(this.$notify.error({title:"删除失败",message:response,position:"bottom-right",duration:6e3}),this.getVMList())})).catch((e=>{console.log("errors",e)}))},errupload(e,t,a){this.$notify.error({title:"上传失败",message:e,position:"bottom-right",duration:6e3}),this.uploadimagevisible=!1,this.getVMList()},sucupload(e,t,a){"I"===e[0]?(this.$notify.success({title:"上传成功",message:"镜像上传成功",position:"bottom-right",duration:6e3}),this.uploadimagevisible=!1,this.getVMList()):(this.$notify.error({title:"上传失败",message:e,position:"bottom-right",duration:6e3}),this.uploadimagevisible=!1,this.getVMList())},handleBeforeUpload(e){console.log(e);var t=e.name.substring(e.name.lastIndexOf(".")+1);const a="tar"===t;return a||(this.$message.error("只能上传TAR文件！"),!1)},data_resolver(e){let t=[],a=e.split("\n"),i=1;for(;i<a.length-1;i++){let e=a[i].split(" ");e=e.filter((function(e){return""!==e})),t.push({imageName:e[0],imageTag:e[1],imageId:e[2],imageSize:e[3]})}return t},getVMList(){this.$axios.post(this.baseurl+"/containerd/images/list?nodeName="+this.$store.state.nodename,{virtualMachineIp:"39.98.124.97",userName:"root",userPassword:"Upc123456@"}).then((e=>{let t=this.data_resolver(e.data.result);this.cidata=t,this.totalci=t.length})).catch((e=>{console.log("errors",e)}))},openUploadImage(){this.uploadimagevisible=!0}},computed:{tmp_nodename_w(){return this.$store.state.nodename}},watch:{tmp_nodename_w(e,t){this.formData.nodeName=this.$store.state.nodename,this.getVMList()}}}),l=o,r=a(1001),n=(0,r.Z)(l,i,s,!1,null,null,null),u=n.exports}}]);
//# sourceMappingURL=935.00d92429.js.map